<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuring a Host with Multiple Interfaces &mdash; perfSONAR Toolkit 3.5rc2 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/perfsonar.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.5rc2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="perfSONAR Toolkit 3.5rc2 documentation" href="index.html" />
    <link rel="next" title="Firewalls and Security Software" href="manage_security.html" />
    <link rel="prev" title="Host Tuning" href="manage_tuning.html" /> 
  </head>
  <body>
    <header>
        <div class="headerContents">
          <a href="index.html" border="0"><img src="_static/perfSONAR-header.gif"></a>
          <div class="acctSearchContainer">
              <section id="searchBox" class="searchBox">
                  <!--Use of this code assumes agreement with the Google Custom Search Terms of Service. -->
                  <!--The terms of service are available at http://www.google.com/cse/docs/tos.html -->
                  <form action="search.html" id="cse-search-box" method="get">
                    <input type="text" name="q" size="25" class="searchInput" placeholder="Search"/>
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                  </form>
              </section>
         </div>
        </div>
    </header>
    <div style="display:block;clear:both;">
    
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="manage_security.html" title="Firewalls and Security Software"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="manage_tuning.html" title="Host Tuning"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">perfSONAR Toolkit 3.5rc2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    </div>
    
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="configuring-a-host-with-multiple-interfaces">
<h1>Configuring a Host with Multiple Interfaces<a class="headerlink" href="#configuring-a-host-with-multiple-interfaces" title="Permalink to this headline">¶</a></h1>
<p>You may run the perfSONAR Toolkit on a host with multiple interfaces. The most common reason to do this is to run throughput and latency tests on separate physical interfaces to prevent interference between the test types. Additional configuration is required to ensure this type of testing works properly. You will need to do the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Decide what IP addresses you are going to assign each interface. See <a class="reference internal" href="#multixface-addressing"><em>IP Addressing Strategy</em></a> for a discussion on choosing subnets and other relevant decision points.</li>
<li>Setup routing rules that ensure when a source IP address is selected for a test, that  the operating system honors that IP address by sending it out the desired interface. A script is provided for this purpose and is detailed in the section <a class="reference internal" href="#multixface-route"><em>Host Routing Table Configuration</em></a></li>
<li>When defining your tests either through the <a class="reference internal" href="manage_regular_tests.html"><em>configuration GUI</em></a> or <a class="reference internal" href="multi_mesh_server_config.html"><em>mesh configuration file</em></a>, you need to select the desired interface. See the individual pages for a description on how to make this selection.</li>
</ol>
</div></blockquote>
<div class="section" id="ip-addressing-strategy">
<span id="multixface-addressing"></span><h2>IP Addressing Strategy<a class="headerlink" href="#ip-addressing-strategy" title="Permalink to this headline">¶</a></h2>
<p>The first decision to be made is how you are going to address the interfaces on your hosts. It is <strong>recommended</strong> that you assign each interface to a different subnet. For example, you may give each interface a /30 with the other end being the gateway. This is not strictly required but considerably simplifies the networking involved and can make debugging easier. You should consult with your local network operators when making this determination.</p>
<p>If you do decide to put both interfaces on the same subnet, special <em>sysctl</em> settings are required to prevent ARP conflicts. These are set by default on the perfSONAR Toolkit but are documented below as reference:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">arp_ignore</span><span class="o">=</span><span class="mi">1</span>
<span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">arp_announce</span><span class="o">=</span><span class="mi">2</span>
<span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">arp_filter</span><span class="o">=</span><span class="mi">1</span>
<span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">arp_filter</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="host-routing-table-configuration">
<span id="multixface-route"></span><h2>Host Routing Table Configuration<a class="headerlink" href="#host-routing-table-configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="adding-routes">
<h3>Adding Routes<a class="headerlink" href="#adding-routes" title="Permalink to this headline">¶</a></h3>
<p>When a regular test is run (or you run a measurement at the command-line using an option to specify the source address), the operating system may or may not use the provided source IP address when deciding which interface on the local host to use for forwarding. Most default routing tables only look at the destination address when making forwarding decisions which can lead to unexpected behavior with your measurements.</p>
<p>In order to avoid this situation, you need to run a special script to aid in route table setup that will look at the source address of your outgoing measurement traffic. The script can be found at <em>/opt/perfsonar_ps/toolkit/scripts/mod_interface_route</em>. For <strong>each interface on the host</strong> you will run the script and provide it with the interface name, IPv4 gateway address (if you plan to use IPv4) and the IPv6 gateway address (if you plan to use IPv6). Assume we have a host with two interfaces each having the following characteristics:</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>Interface 1</dt>
<dd><table class="first last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Interface Name:</th><td class="field-body">eth0</td>
</tr>
<tr class="field-even field"><th class="field-name">IPv4 Address:</th><td class="field-body">10.0.0.2</td>
</tr>
<tr class="field-odd field"><th class="field-name">IPv4 Gateway:</th><td class="field-body">10.0.0.1</td>
</tr>
<tr class="field-even field"><th class="field-name">IPv6 Address:</th><td class="field-body">fde1:40ff:e1a3:d50e::2</td>
</tr>
<tr class="field-odd field"><th class="field-name">IPv6 Gateway:</th><td class="field-body">fde1:40ff:e1a3:d50e::1</td>
</tr>
</tbody>
</table>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Interface 2</dt>
<dd><table class="first last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Interface Name:</th><td class="field-body">eth1</td>
</tr>
<tr class="field-even field"><th class="field-name">IPv4 Address:</th><td class="field-body">10.1.1.2</td>
</tr>
<tr class="field-odd field"><th class="field-name">IPv4 Gateway:</th><td class="field-body">10.1.1.1</td>
</tr>
<tr class="field-even field"><th class="field-name">IPv6 Address:</th><td class="field-body">fd7d:3189:ed46:2736::2</td>
</tr>
<tr class="field-odd field"><th class="field-name">IPv6 Gateway:</th><td class="field-body">fd7d:3189:ed46:2736::1</td>
</tr>
</tbody>
</table>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>Below is an example of the commands we would run to install the rules required to correctly use both interfaces for measurement traffic:</p>
<div class="highlight-python"><div class="highlight"><pre>/opt/perfsonar_ps/toolkit/scripts/mod_interface_route --command add --device eth0 --ipv4_gateway 10.0.0.1 --ipv6_gateway fde1:40ff:e1a3:d50e::1
/opt/perfsonar_ps/toolkit/scripts/mod_interface_route --command add --device eth1 --ipv4_gateway 10.1.1.1 --ipv6_gateway fd7d:3189:ed46:2736::1
</pre></div>
</div>
<p>Replace the options above with those relevant to each interface on your host to create the necessary rules.</p>
<p>After performing the task above, your routes should now be setup. There are two ways to enable the newly installed rules to persist between system reboots. One is to set the <strong>mod_interface_route</strong> command to run whenever the machine boots, and the other is to configure the <strong>mod_interface_route</strong> command to run whenever the interface is brought up or torn down.</p>
<p>The easiest approach is to have the routes setup when the machine boots. To do this, it is recommended that you add the <em>mod_interface_route</em> commands to <strong>/etc/rc.local</strong>. Copy them exactly as you ran them at the command-line and they should get executed each time your host starts.</p>
<p>To have the routes setup whenever the interface is brought up, you will need to create two shell scripts: <strong>/sbin/ifup-local</strong> and <strong>/sbin/ifdown-local</strong>. The <strong>/sbin/ifup-local</strong> script gets executed whenever an interface is brought up, and will be used setup the route. The <strong>/sbin/ifdown-local</strong> script gets executed whenever an interface is brought down, and will be used to remove the route. Both scripts get executed with the interface name as the first parameter. The scripts then take the appropriate steps based on which interface is being taken up or torn down.</p>
<p>An example <strong>/sbin/ifup-local</strong> script based on the example interfaces above:</p>
<div class="highlight-python"><div class="highlight"><pre>#/bin/sh
INTERFACE=$1

if [ &quot;$INTERFACE&quot; == &quot;eth0&quot; ]; then
    /opt/perfsonar_ps/toolkit/scripts/mod_interface_route --command add --device eth0 --ipv4_gateway 10.0.0.1 --ipv6_gateway fde1:40ff:e1a3:d50e::1
elif [ &quot;$INTERFACE&quot; == &quot;eth1&quot; ]; then
    /opt/perfsonar_ps/toolkit/scripts/mod_interface_route --command add --device eth1 --ipv4_gateway 10.1.1.1 --ipv6_gateway fd7d:3189:ed46:2736::1
fi
</pre></div>
</div>
<p>An example <strong>/sbin/ifdown-local</strong> script based on the example interfaces above:</p>
<div class="highlight-python"><div class="highlight"><pre>#!/bin/sh

INTERFACE=$1

if [ &quot;$INTERFACE&quot; == &quot;eth0&quot; -o &quot;$INTERFACE&quot; == &quot;eth1&quot; ]; then
    /opt/perfsonar_ps/toolkit/scripts/mod_interface_route  --command delete --device  $1
fi
</pre></div>
</div>
<p>After you have created those scripts, make sure that they are executable by running <strong>chmod ugo+x /sbin/ifup-local /sbin/ifdown-local</strong>.</p>
</div>
<div class="section" id="viewing-routes">
<h3>Viewing Routes<a class="headerlink" href="#viewing-routes" title="Permalink to this headline">¶</a></h3>
<p>You may see the IPv4 changes by running the command <tt class="docutils literal"><span class="pre">ip</span> <span class="pre">rule</span> <span class="pre">list</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre># ip rule list
0:  from all lookup local
200:        from 10.0.0.2 lookup eth0_source_route
200:        from 10.1.1.2 lookup eth1_source_route
32766:      from all lookup main
32767:      from all lookup default
</pre></div>
</div>
<p>You may see the IPv6 changes by running the command <tt class="docutils literal"><span class="pre">ip</span> <span class="pre">-6</span> <span class="pre">rule</span> <span class="pre">list</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre># ip -6 rule list
0:  from all lookup local
200:        from fde1:40ff:e1a3:d50e::2 lookup eth0_source_route
200:        from fd7d:3189:ed46:2736::2 lookup eth1_source_route
32766:      from all lookup main
</pre></div>
</div>
</div>
<div class="section" id="deleting-routes">
<h3>Deleting Routes<a class="headerlink" href="#deleting-routes" title="Permalink to this headline">¶</a></h3>
<p>If you would like to remove previously added rules and routes, simply give the <em>mod_interface_route</em> script the <em>delete</em> command and the device for which you want the rules removed. For example to remove both the rules from our previous example, run:</p>
<div class="highlight-python"><div class="highlight"><pre>/opt/perfsonar_ps/toolkit/scripts/mod_interface_route --command delete --device eth0
/opt/perfsonar_ps/toolkit/scripts/scripts/mod_interface_route --command delete --device eth1
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <nav id="channelNav" class="channelNav">
                
                <ul>
<li><a class="reference internal" href="#">Configuring a Host with Multiple Interfaces</a><ul>
<li><a class="reference internal" href="#ip-addressing-strategy">IP Addressing Strategy</a></li>
<li><a class="reference internal" href="#host-routing-table-configuration">Host Routing Table Configuration</a><ul>
<li><a class="reference internal" href="#adding-routes">Adding Routes</a></li>
<li><a class="reference internal" href="#viewing-routes">Viewing Routes</a></li>
<li><a class="reference internal" href="#deleting-routes">Deleting Routes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                <ul>
                  <li>
                  <a href="manage_tuning.html">Previous topic</a>
                  <ul><li><a href="manage_tuning.html" title="previous chapter">Host Tuning</a></li></ul>
                  </li>
                </ul>
                  <ul>
                      <li>
                      <a href="manage_security.html">Next topic</a>
                      <ul><li><a href="manage_security.html" title="next chapter">Firewalls and Security Software</a></li></ul>
                      </li>
                  </ul>
                
                
            </nav>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="manage_security.html" title="Firewalls and Security Software"
             >next</a> |</li>
        <li class="right" >
          <a href="manage_tuning.html" title="Host Tuning"
             >previous</a> |</li>
        <li><a href="index.html">perfSONAR Toolkit 3.5rc2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <footer id="fat">
        <div class="footerContents">
            <nav id="fatFooterNav" class="fatFooterNav">
                <ul id="menu-partners" class="menu depth-0">
                    <li id="footer-partner-text" class="partner-menu">
                        perfSONAR 
                        <br>
                        partners 
                        <br>
                        include: 
                    </li>
    
                <li id="footer-partner-esnet" class="partner-menu">
                    <a href="http://www.es.net/" title="Visit DOE's Energy Sciences Network"><img src="_static/ESnet-ps.png" alt="" style="border:none;"></a> </li>
                
                <li id="footer-partner-geant" class="partner-menu">
                    <a href="http://www.geant.org/" title="Visit GEANT"><img src="_static/geant-ps.png" alt="" style="border:none;"/></a> </li>
        
                <li id="footer-partner-iu" class="partner-menu">
                    <a href="http://www.iu.edu/" title="Visit Indiana University"><img src="_static/IU-ps.png" alt="" style="border:none;"></a> </li>

                <li id="footer-partner-i2" class="partner-menu">
                    <a href="http://www.internet2.edu/" title="Visit Internet2"><img src="_static/I2-ps.png" alt="" style="border:none;"></a> </li>
    
                </ul>

             
            </nav>
            <nav id="minFooterNav" class="minFooterNav">
                <span class="copyright">PERFormance Service Oriented Network monitoring ARchitecture </span>
            </nav>
          
        </div> <!-- /footerContents -->
    </footer>
    
    <div class="footer">
        &copy; Copyright 2015, perfSONAR Project.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>