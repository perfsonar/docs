
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Viewing Legacy Esmond Data &#8212; perfSONAR Toolkit 5.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    <link rel="stylesheet" href="_static/perfsonar.css" type="text/css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="What is MaDDash?" href="maddash_intro.html" />
    <link rel="prev" title="Deploying a Central Measurement Archive" href="multi_ma_install.html" /> 
  </head><body>
    <header>
        <div class="headerContents">
          <a href="index.html" border="0"><img src="_static/perfsonar-logo-black-full-100.png"></a>
          <div class="acctSearchContainer">
              <section id="searchBox" class="searchBox">
                  <!--Use of this code assumes agreement with the Google Custom Search Terms of Service. -->
                  <!--The terms of service are available at http://www.google.com/cse/docs/tos.html -->
                  <form action="search.html" id="cse-search-box" method="get">
                    <input type="text" name="q" size="25" class="searchInput" placeholder="Search"/>
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                  </form>
              </section>
         </div>
        </div>
    </header>
    <div style="display:block;clear:both;">
    
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="maddash_intro.html" title="What is MaDDash?"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="multi_ma_install.html" title="Deploying a Central Measurement Archive"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">perfSONAR Toolkit 5.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Viewing Legacy Esmond Data</a></li> 
      </ul>
    </div>
    </div>
    
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="viewing-legacy-esmond-data">
<h1>Viewing Legacy Esmond Data<a class="headerlink" href="#viewing-legacy-esmond-data" title="Permalink to this heading">¶</a></h1>
<p>Starting with perfSONAR 5.0, the data archive used to store measurements was replaced. On Toolkit installations, the data was left on disk but not imported into a new database. If you need to access the data, it is required you copy it to a new host running esmond.</p>
<p>This document will walk you through the process of copying legacy Esmond data from a Toolkit host to a new standalone Esmond instance.</p>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading">¶</a></h2>
<p>In order to complete this process there are a few requirements:</p>
<blockquote>
<div><ul class="simple">
<li><p>You have two hosts: 1) The Toolkit host with the old data you wih to migrate (host referred to as “Toolkit” for remainder of document) and 2) The new standalone Esmond host (host referred to as “Esmond” through remainder of this document)</p></li>
<li><p>Both the toolkit host and the esmond host have the same operating system, PostgreSQL, and Cassandra versions. Generally if both systems are up-to-date this should be the case.</p></li>
<li><p>The Toolkit host has SSH access to the Esmond host</p></li>
</ul>
</div></blockquote>
</section>
<section id="migration-process">
<h2>Migration Process<a class="headerlink" href="#migration-process" title="Permalink to this heading">¶</a></h2>
<p>A summary of the migration process can be broken into three sections as follows:</p>
<ol class="arabic simple">
<li><p>You will setup the new Esmond host</p></li>
<li><p>You will use scp to copy the data from the toolkit host to the Esmond host</p></li>
<li><p>You will move the copied data to the correct locations on the Esmond host and restart relevant services</p></li>
</ol>
<p>After that you have a new standalone esmond. The detailed steps are found in the sections below.</p>
<section id="step-1-preparing-the-new-esmond-host">
<h3>Step 1: Preparing the new Esmond host<a class="headerlink" href="#step-1-preparing-the-new-esmond-host" title="Permalink to this heading">¶</a></h3>
<ol class="arabic">
<li><p>Become sudo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
</li>
<li><p>Install perfSONAR RPM Repo key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">linux</span><span class="o">.</span><span class="n">mirrors</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">RPM</span><span class="o">-</span><span class="n">GPG</span><span class="o">-</span><span class="n">KEY</span><span class="o">-</span><span class="n">perfSONAR</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">rpm</span><span class="o">-</span><span class="n">gpg</span><span class="o">/</span><span class="n">RPM</span><span class="o">-</span><span class="n">GPG</span><span class="o">-</span><span class="n">KEY</span><span class="o">-</span><span class="n">perfSONAR</span>
</pre></div>
</div>
</li>
<li><p>You will need to point your system at an old perfSONAR package repository. In order to do so, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">yum</span><span class="o">.</span><span class="n">repos</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">perfsonar4</span><span class="o">.</span><span class="n">repo</span>
<span class="p">[</span><span class="n">perfSONAR4</span><span class="p">]</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">perfSONAR</span> <span class="mf">4.0</span> <span class="n">RPM</span> <span class="n">Repository</span>
<span class="n">baseurl</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">linux</span><span class="o">.</span><span class="n">mirrors</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">el7</span><span class="o">/</span><span class="n">x86_64</span><span class="o">/</span><span class="mi">4</span>
<span class="n">enabled</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">protect</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">gpgkey</span> <span class="o">=</span> <span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">etc</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">rpm</span><span class="o">-</span><span class="n">gpg</span><span class="o">/</span><span class="n">RPM</span><span class="o">-</span><span class="n">GPG</span><span class="o">-</span><span class="n">KEY</span><span class="o">-</span><span class="n">perfSONAR</span>
<span class="n">gpgcheck</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">EOF</span>
</pre></div>
</div>
</li>
<li><p>Clear the yum cache to make sure it sees your new repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">clean</span> <span class="nb">all</span>
</pre></div>
</div>
</li>
<li><p>Install the esmond package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">esmond</span>
</pre></div>
</div>
</li>
<li><p>Check that esmond install properly. The below command should return <cite>[]</cite> if things are working:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">k</span> <span class="s2">&quot;https://localhost/esmond/perfsonar/archive/&quot;</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="step-2-copying-data-from-toolkit-to-standalone-esmond-instance">
<h3>Step 2: Copying Data From Toolkit to Standalone Esmond Instance<a class="headerlink" href="#step-2-copying-data-from-toolkit-to-standalone-esmond-instance" title="Permalink to this heading">¶</a></h3>
<ol class="arabic">
<li><p>SSH into you Toolkit host and become sudo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
</li>
<li><p>Copy postgresql data to Esmond host (where USER and ESMOND_HOST are replaced with the username and address of the ESMOND host respectively):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pgsql</span><span class="o">/</span> <span class="n">USER</span><span class="nd">@ESMOND_HOST</span><span class="p">:</span><span class="n">pgsql</span>
</pre></div>
</div>
</li>
<li><p>Copy cassandra data to Esmond host:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">cassandra</span><span class="o">/</span> <span class="n">USER</span><span class="nd">@ESMOND_HOST</span><span class="p">:</span><span class="n">cassandra</span>
</pre></div>
</div>
</li>
<li><p>Copy old Esmond configuration to Esmond host:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scp</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">esmond</span><span class="o">/</span> <span class="n">USER</span><span class="nd">@ESMOND_HOST</span><span class="p">:</span><span class="n">esmond</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="step-3-installing-and-configuring-esmond">
<h3>Step 3: Installing and Configuring Esmond<a class="headerlink" href="#step-3-installing-and-configuring-esmond" title="Permalink to this heading">¶</a></h3>
<ol class="arabic">
<li><p>Log back into the Esmond host and make sure you are sudo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
</li>
<li><p>Install the copied postgresql data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">stop</span> <span class="n">postgresql</span><span class="o">-</span><span class="mi">10</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pgsql</span>
<span class="n">mv</span> <span class="n">pgsql</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pgsql</span>
<span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">postgres</span><span class="p">:</span><span class="n">postgres</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pgsql</span>
<span class="n">systemctl</span> <span class="n">start</span> <span class="n">postgresql</span><span class="o">-</span><span class="mi">10</span>
</pre></div>
</div>
</li>
<li><p>Install the copied cassandra data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">stop</span> <span class="n">cassandra</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">cassandra</span>
<span class="n">mv</span> <span class="n">cassandra</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">cassandra</span>
<span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">cassandra</span><span class="p">:</span><span class="n">cassandra</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">cassandra</span>
<span class="n">systemctl</span> <span class="n">start</span> <span class="n">cassandra</span>
</pre></div>
</div>
</li>
<li><p>Install the esmond configuation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">stop</span> <span class="n">httpd</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">esmond</span>
<span class="n">mv</span> <span class="n">esmond</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">esmond</span>
<span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">root</span><span class="p">:</span><span class="n">root</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">esmond</span>
<span class="n">restorecon</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">esmond</span><span class="o">/</span><span class="n">esmond</span><span class="o">.</span><span class="n">conf</span>
<span class="n">systemctl</span> <span class="n">start</span> <span class="n">httpd</span>
</pre></div>
</div>
</li>
<li><p>Verify the installation. The following command should return test results if the above worked correctly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">k</span> <span class="s2">&quot;https://localhost/esmond/perfsonar/archive/?limit=10&quot;</span>
</pre></div>
</div>
</li>
</ol>
<p>If you get any errors after completing the steps above there are a few things to check:</p>
<ul class="simple">
<li><p>Look for hints as the problem in <cite>/var/log/httpd/ssl_error_log</cite>, <cite>/var/log/esmond/django.log</cite> and <cite>/var/log/esmond/esmond.log</cite></p></li>
<li><p>The install should work with SELinucx but you may want to test with selinux disabled to see if that is causing issues: <cite>setenforce 0</cite> and re-run curl commands above.</p></li>
<li><p>Double check the file permissions and ownership. You can always compare these things to the original host.</p></li>
</ul>
</section>
</section>
<section id="accessing-the-esmond-host-data">
<h2>Accessing the Esmond host data<a class="headerlink" href="#accessing-the-esmond-host-data" title="Permalink to this heading">¶</a></h2>
<p>The data for your new esmond host is available at <cite>https://ESMOND_HOST/esmond/perfsonar/archive/</cite> where ESMOND_HOST is replaced with the name of your hosts.</p>
<p>If you want to look at graphs using this archive, you can manipulate the URL of an existing graphs install (it does not need to be on the same host, though you can install the graphs locally with <cite>yum install perfsonar-graphs</cite>). For example, lets say I am looking at a graph on my 5.0 Toolkit host that looks like the following:</p>
<blockquote>
<div><p><a class="reference external" href="https://TOOLKIT_HOST/perfsonar-graphs/?source=10.1.1.1&amp;dest=10.1.1.2&amp;url=https://TOOLKIT_HOST/esmond/perfsonar/archive/&amp;timeframe=1w">https://TOOLKIT_HOST/perfsonar-graphs/?source=10.1.1.1&amp;dest=10.1.1.2&amp;url=https://TOOLKIT_HOST/esmond/perfsonar/archive/&amp;timeframe=1w</a></p>
</div></blockquote>
<p>You can copy paste this URL and replace the <cite>url</cite> parameter to look at the Esmond instance with the old data:</p>
<blockquote>
<div><p><a class="reference external" href="https://TOOLKIT_HOST/perfsonar-graphs/?source=10.1.1.1&amp;dest=10.1.1.2&amp;url=https://ESMOND_HOST/esmond/perfsonar/archive/&amp;timeframe=1w">https://TOOLKIT_HOST/perfsonar-graphs/?source=10.1.1.1&amp;dest=10.1.1.2&amp;url=https://ESMOND_HOST/esmond/perfsonar/archive/&amp;timeframe=1w</a></p>
</div></blockquote>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <nav id="channelNav" class="channelNav">
                
                <ul>
<li><a class="reference internal" href="#">Viewing Legacy Esmond Data</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#migration-process">Migration Process</a><ul>
<li><a class="reference internal" href="#step-1-preparing-the-new-esmond-host">Step 1: Preparing the new Esmond host</a></li>
<li><a class="reference internal" href="#step-2-copying-data-from-toolkit-to-standalone-esmond-instance">Step 2: Copying Data From Toolkit to Standalone Esmond Instance</a></li>
<li><a class="reference internal" href="#step-3-installing-and-configuring-esmond">Step 3: Installing and Configuring Esmond</a></li>
</ul>
</li>
<li><a class="reference internal" href="#accessing-the-esmond-host-data">Accessing the Esmond host data</a></li>
</ul>
</li>
</ul>

                <ul>
                  <li>
                  <a href="multi_ma_install.html">Previous topic</a>
                  <ul><li><a href="multi_ma_install.html" title="previous chapter">Deploying a Central Measurement Archive</a></li></ul>
                  </li>
                </ul>
                  <ul>
                      <li>
                      <a href="maddash_intro.html">Next topic</a>
                      <ul><li><a href="maddash_intro.html" title="next chapter">What is MaDDash?</a></li></ul>
                      </li>
                  </ul>
                
                
            </nav>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="maddash_intro.html" title="What is MaDDash?"
             >next</a> |</li>
        <li class="right" >
          <a href="multi_ma_install.html" title="Deploying a Central Measurement Archive"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">perfSONAR Toolkit 5.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Viewing Legacy Esmond Data</a></li> 
      </ul>
    </div>
    <footer id="fat">
        <div class="footerContents">
            <nav id="fatFooterNav" class="fatFooterNav">
                <ul id="menu-partners" class="menu depth-0">
                    <li id="footer-partner-text" class="partner-menu">
                        perfSONAR 
                        <br>
                        partners 
                        <br>
                        include: 
                    </li>
    
                <li id="footer-partner-esnet" class="partner-menu">
                    <a href="http://www.es.net/" title="Visit DOE's Energy Sciences Network"><img src="_static/ESnet-ps.png" alt="" style="border:none;"></a> </li>
                
                <li id="footer-partner-geant" class="partner-menu">
                    <a href="http://www.geant.org/" title="Visit GEANT"><img src="_static/geant-ps.png" alt="" style="border:none;"/></a> </li>
        
                <li id="footer-partner-iu" class="partner-menu">
                    <a href="http://www.iu.edu/" title="Visit Indiana University"><img src="_static/IU-ps.png" alt="" style="border:none;"></a> </li>

                <li id="footer-partner-i2" class="partner-menu">
                    <a href="http://www.internet2.edu/" title="Visit Internet2"><img src="_static/I2-ps.png" alt="" style="border:none;"></a> </li>
					
				<li id="footer-partner-rnp" class="partner-menu">
                    <a href="https://www.rnp.br/en" title="Visit RNP"><img src="_static/rnp.png" alt="" style="border:none;"></a> </li>
                
                <li id="footer-partner-um" class="partner-menu">
                    <a href="http://www.umich.edu/" title="Visit University of Michigan"><img src="_static/UM-ps.png" alt="" style="border:none;"></a> </li>

                </ul>

            </nav>
            <nav id="minFooterNav" class="minFooterNav">
                <span class="copyright">PERFormance Service Oriented Network monitoring ARchitecture </span>
            </nav>
          
        </div> <!-- /footerContents -->
    </footer>
    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, perfSONAR Project.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
  </body>
</html>