
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Running the pSConfig pScheduler Agent &#8212; perfSONAR Toolkit 5.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    <link rel="stylesheet" href="_static/perfsonar.css" type="text/css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running the pSConfig Grafana Agent" href="psconfig_grafana_agent.html" />
    <link rel="prev" title="Publishing a pSConfig Template" href="psconfig_publish.html" />
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-52RNZ729B1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', 'G-52RNZ729B1');
	</script>
	 

  </head><body>
    <header>
        <div class="headerContents">
          <a href="index.html" border="0"><img src="_static/perfsonar-logo-black-full-100.png"></a>
          <div class="acctSearchContainer">
              <section id="searchBox" class="searchBox">
                  <!--Use of this code assumes agreement with the Google Custom Search Terms of Service. -->
                  <!--The terms of service are available at http://www.google.com/cse/docs/tos.html -->
                  <form action="search.html" id="cse-search-box" method="get">
                    <input type="text" name="q" size="25" class="searchInput" placeholder="Search"/>
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                  </form>
              </section>
         </div>
        </div>
    </header>
    <div style="display:block;clear:both;">
    
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="psconfig_grafana_agent.html" title="Running the pSConfig Grafana Agent"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="psconfig_publish.html" title="Publishing a pSConfig Template"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">perfSONAR Toolkit 5.1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Running the pSConfig pScheduler Agent</a></li> 
      </ul>
    </div>
    </div>
    
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="running-the-psconfig-pscheduler-agent">
<h1>Running the pSConfig pScheduler Agent<a class="headerlink" href="#running-the-psconfig-pscheduler-agent" title="Permalink to this heading">¶</a></h1>
<section id="introduction">
<span id="psconfig-pscheduler-agent-intro"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<section id="psconfig-pscheduler-agent-s-role">
<span id="psconfig-pscheduler-agent-intro-role"></span><h3>pSConfig pScheduler Agent’s Role<a class="headerlink" href="#psconfig-pscheduler-agent-s-role" title="Permalink to this heading">¶</a></h3>
<p>The role of the <em>pSConfig pScheduler Agent</em> is to read <a class="reference internal" href="psconfig_intro.html"><span class="doc">pSConfig templates</span></a> and generate a set of <a class="reference internal" href="pscheduler_intro.html"><span class="doc">pScheduler</span></a> <a class="reference internal" href="pscheduler_intro.html#term-Task"><span class="xref std std-term">tasks</span></a>. The diagram below describes this role:</p>
<figure class="align-center" id="id4">
<img alt="_images/psconfig_pscheduler_agent-arch.png" src="_images/psconfig_pscheduler_agent-arch.png" />
<figcaption>
<p><span class="caption-text"><em>A diagram showing the psconfig-pscheduler-agent reading templates from a number of sources and submitting tasks to pScheduler servers.</em></span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Performing this role is a multi-step process that includes the following:</p>
<ol class="arabic simple">
<li><p>Read the configured templates and optionally apply local modifications</p></li>
<li><p>Determine the pScheduler tasks to schedule</p></li>
<li><p>Communicate with the appropriate pScheduler servers to ensure the tasks are created</p></li>
</ol>
<p>These steps are completed anytime one of the following events occur:</p>
<ul class="simple">
<li><p>The agent starts</p></li>
<li><p>Within a configurable amount of time of a change to a <em>local</em> configuration file (changes to remote files are not detected). By default the value is <em>1 minute</em>.</p></li>
<li><p>If no changes, on a configurable interval after the start of the last run. By default these steps are run every <em>1 hour</em>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="#psconfig-pscheduler-agent-advanced"><span class="std std-ref">Advanced Configuration</span></a> for more detail on the configuration options mentioned above.</p>
</div>
<p>The remainder of this section describes each of these steps in greater detail.</p>
</section>
<section id="reading-and-modifying-templates">
<span id="psconfig-pscheduler-agent-intro-read"></span><h3>Reading and Modifying Templates<a class="headerlink" href="#reading-and-modifying-templates" title="Permalink to this heading">¶</a></h3>
<p>The agents first job is to read a set of <a class="reference internal" href="psconfig_templates_intro.html"><span class="doc">templates</span></a>. The templates to read are configured by the administrator of the agent. For information on how to configure templates see <a class="reference internal" href="#psconfig-pscheduler-agent-templates"><span class="std std-ref">Configuring Templates</span></a>.</p>
<p>After reading a template, an agent is also capable of performing local modifications to that template. The types of modifications supported include:</p>
<ul class="simple">
<li><p>Inclusion of default archives for all tasks. See <a class="reference internal" href="#psconfig-pscheduler-agent-modify-archives"><span class="std std-ref">Configuring Default Archives</span></a> for more detail.</p></li>
<li><p>Direct transformations to the template JSON. See <a class="reference internal" href="#psconfig-pscheduler-agent-modify-transform-one"><span class="std std-ref">Transforming Individual Remote Templates</span></a> and <a class="reference internal" href="#psconfig-pscheduler-agent-modify-transform-all"><span class="std std-ref">Transforming All Remote Templates</span></a> for more detail.</p></li>
</ul>
</section>
<section id="determining-the-pscheduler-tasks-to-create">
<span id="psconfig-pscheduler-agent-intro-determine"></span><h3>Determining the pScheduler Tasks to Create<a class="headerlink" href="#determining-the-pscheduler-tasks-to-create" title="Permalink to this heading">¶</a></h3>
<p>An individual agent is not necessarily responsible for creating and managing all the tasks described by a template. Instead, an agent looks at the <a class="reference internal" href="psconfig_templates_intro.html#psconfig-templates-intro-concepts-addresses"><span class="std std-ref">address objects</span></a> associated with individual tasks and only concerns itself with those it is configured to manage. It determines these addresses as follows:</p>
<ul class="simple">
<li><p>By default, the agent detects the addresses on the local interfaces of the host which it runs.</p></li>
<li><p>The default behavior can be overriden by setting the <code class="docutils literal notranslate"><span class="pre">addresses</span></code> option in the default configuration file. See <a class="reference internal" href="#psconfig-pscheduler-agent-advanced"><span class="std std-ref">Advanced Configuration</span></a> for more detail.</p></li>
</ul>
<p>Once it has the list of addresses for which it is responsible, it is not just a matter of seeing if one of the addresses is in the generated address list for a task. Instead, it must also analyze if the address it matches is also the one designated to schedule the task. This designation is dependent on the task configuration. A full discussion of this stage of the decision process can be found in <a class="reference internal" href="psconfig_templates_advanced.html#psconfig-templates-advanced-tasks-scheduled-by"><span class="std std-ref">Controlling the Agent That Schedules a Task</span></a>.</p>
</section>
<section id="communicating-with-pscheduler">
<span id="psconfig-pscheduler-agent-intro-communicate"></span><h3>Communicating with pScheduler<a class="headerlink" href="#communicating-with-pscheduler" title="Permalink to this heading">¶</a></h3>
<p>Once the set of tasks that needs to be managed is determined, the agent must then decide which pScheduler servers to contact to make sure they are created. It does this by contacting a pScheduler <a class="reference internal" href="pscheduler_intro.html#term-Assist-Server"><span class="xref std std-term">assist server</span></a> that will identify a <a class="reference internal" href="pscheduler_intro.html#term-Lead-Participant"><span class="xref std std-term">lead participant</span></a>. The assist server is a pScheduler server running on the local host of the agent by default, but this <a class="reference internal" href="#psconfig-pscheduler-agent-advanced"><span class="std std-ref">can be overridden</span></a>. How the lead is determined is test plug-in dependent which is why the agent needs a pScheduler assist server to make the decision.</p>
<p>Once it has the lead, the pSConfig agent will contact that server to see if the task already exists and will create it if not. Tasks are created with an end time that is the later of the following:</p>
<ul class="simple">
<li><p>A configurable fixed amount of time after the task is created. By default this is <em>24 hours</em>.</p></li>
<li><p>The length of time required to complete a configurable number of runs. By default the value is <em>2</em>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="#psconfig-pscheduler-agent-advanced"><span class="std std-ref">Advanced Configuration</span></a> for more detail on the configuration options listed above.</p>
</div>
<p>The task will be recreated after its expiration if it is still in the template. If at any point a task is removed, then the task will be canceled the next time the agent runs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The new task is actually put on the schedule several hours before it is set to expire, but with a start time that matches the end time of the old task. This should minimize any downtime between the transition but also prevent test collisions.</p>
</div>
<p>When finished communicating with all the required pScheduler servers, the agent will remain idle until its next run.</p>
</section>
</section>
<section id="installation">
<span id="psconfig-pscheduler-agent-install"></span><h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h2>
<section id="installing-the-standalone-package">
<span id="psconfig-pscheduler-agent-standalone"></span><h3>Installing the Standalone Package<a class="headerlink" href="#installing-the-standalone-package" title="Permalink to this heading">¶</a></h3>
<p>The pSConfig pScheduler agent is installed with the package <code class="docutils literal notranslate"><span class="pre">perfsonar-psconfig-pscheduler</span></code>. You can run the following commands to install it:</p>
<blockquote>
<div><p><em>RedHat</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dnf</span> <span class="n">install</span> <span class="n">perfsonar</span><span class="o">-</span><span class="n">psconfig</span><span class="o">-</span><span class="n">pscheduler</span>
</pre></div>
</div>
<p><em>Debian/Ubuntu</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">perfsonar</span><span class="o">-</span><span class="n">psconfig</span><span class="o">-</span><span class="n">pscheduler</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="installing-as-part-of-a-bundle">
<span id="psconfig-pscheduler-agent-bundle"></span><h3>Installing as Part of a Bundle<a class="headerlink" href="#installing-as-part-of-a-bundle" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">perfsonar-psconfig-pscheduler</span></code> is included in the following <a class="reference internal" href="install_options.html"><span class="doc">perfSONAR bundles</span></a>:</p>
<ul class="simple">
<li><p><em>perfsonar-testpoint</em></p></li>
<li><p><em>perfsonar-core</em></p></li>
<li><p><em>perfsonar-toolkit</em></p></li>
</ul>
</section>
</section>
<section id="running-psconfig-pscheduler-agent">
<span id="psconfig-pscheduler-agent-run"></span><h2>Running <code class="docutils literal notranslate"><span class="pre">psconfig-pscheduler-agent</span></code><a class="headerlink" href="#running-psconfig-pscheduler-agent" title="Permalink to this heading">¶</a></h2>
<section id="starting-psconfig-pscheduler-agent">
<span id="psconfig-pscheduler-agent-run-start"></span><h3>Starting <code class="docutils literal notranslate"><span class="pre">psconfig-pscheduler-agent</span></code><a class="headerlink" href="#starting-psconfig-pscheduler-agent" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">start</span> <span class="n">psconfig</span><span class="o">-</span><span class="n">pscheduler</span><span class="o">-</span><span class="n">agent</span>
</pre></div>
</div>
</section>
<section id="stopping-psconfig-pscheduler-agent">
<span id="psconfig-pscheduler-agent-run-stop"></span><h3>Stopping <code class="docutils literal notranslate"><span class="pre">psconfig-pscheduler-agent</span></code><a class="headerlink" href="#stopping-psconfig-pscheduler-agent" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">stop</span> <span class="n">psconfig</span><span class="o">-</span><span class="n">pscheduler</span><span class="o">-</span><span class="n">agent</span>
</pre></div>
</div>
</section>
<section id="restarting-psconfig-pscheduler-agent">
<span id="psconfig-pscheduler-agent-run-restart"></span><h3>Restarting <code class="docutils literal notranslate"><span class="pre">psconfig-pscheduler-agent</span></code><a class="headerlink" href="#restarting-psconfig-pscheduler-agent" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">restart</span> <span class="n">psconfig</span><span class="o">-</span><span class="n">pscheduler</span><span class="o">-</span><span class="n">agent</span>
</pre></div>
</div>
</section>
<section id="checking-the-status-of-psconfig-pscheduler-agent">
<span id="psconfig-pscheduler-agent-run-status"></span><h3>Checking the status of <code class="docutils literal notranslate"><span class="pre">psconfig-pscheduler-agent</span></code><a class="headerlink" href="#checking-the-status-of-psconfig-pscheduler-agent" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">status</span> <span class="n">psconfig</span><span class="o">-</span><span class="n">pscheduler</span><span class="o">-</span><span class="n">agent</span>
</pre></div>
</div>
</section>
</section>
<section id="configuring-templates">
<span id="psconfig-pscheduler-agent-templates"></span><h2>Configuring Templates<a class="headerlink" href="#configuring-templates" title="Permalink to this heading">¶</a></h2>
<section id="configuration-basics">
<span id="psconfig-pscheduler-agent-templates-basics"></span><h3>Configuration Basics<a class="headerlink" href="#configuration-basics" title="Permalink to this heading">¶</a></h3>
<p>In order for the agent to create tasks, it must first be configured to read one or more templates. There are multiple ways to add a template depending on its location relative to the host system of the agent. These include:</p>
<ol class="arabic simple">
<li><p>Configuring <em>remote</em> templates  by supplying a URL and desired options to the agent. This is most commonly done using the <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span></code> command. See <a class="reference internal" href="#psconfig-pscheduler-agent-templates-remote"><span class="std std-ref">Remote Templates</span></a> for details.</p></li>
<li><p>Configuring <em>local</em> templates that live on the agent’s filesystem either using the <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span></code> command or by copying the template files to a dedicated directory whose contents are automatically read by the agent. See <a class="reference internal" href="#psconfig-pscheduler-agent-templates-local"><span class="std std-ref">Local Templates</span></a> for details.</p></li>
</ol>
</section>
<section id="remote-templates">
<span id="psconfig-pscheduler-agent-templates-remote"></span><h3>Remote Templates<a class="headerlink" href="#remote-templates" title="Permalink to this heading">¶</a></h3>
<p>The primary way to add, list, and delete the remote templates read by the agent is with the <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span></code> command.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span></code> command simply edits the <code class="docutils literal notranslate"><span class="pre">/etc/perfsonar/psconfig/pscheduler-agent.json</span></code> file. For most users it is recommended to use the <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span></code> command as opposed to editing the file directly as it is less prone to syntax errors.</p>
</div>
<p>As an example let’s say we have a pSConfig template at the URL <code class="docutils literal notranslate"><span class="pre">https://10.0.0.1/example.json</span></code>. The agent can be configured to read the template by running the following command <strong>as a root user</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psconfig</span> <span class="n">remote</span> <span class="n">add</span> <span class="s2">&quot;https://10.0.0.1/example.json&quot;</span>
</pre></div>
</div>
<p>The above command will add the new template to the agent. The agent should begin reading the template within 60 seconds of the change if using default settings (i.e. no agent restart required).</p>
<p>You may also provide the command with additional processing instructions. For example, the default behavior of the agent is to ignore the archive definitions of the remote template. This is to ensure the local administrator has a chance to “opt-in” to where the results are sent. To use the archives defined in the remote template we can provide the <code class="docutils literal notranslate"><span class="pre">--configure-archives</span></code> option as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psconfig</span> <span class="n">remote</span> <span class="n">add</span> <span class="o">--</span><span class="n">configure</span><span class="o">-</span><span class="n">archives</span> <span class="s2">&quot;https://10.0.0.1/example.json&quot;</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span></code> command ensures a given URL is only used once by the agent. If we already had <code class="docutils literal notranslate"><span class="pre">https://10.0.0.1/example.json</span></code> in our file and then ran the command above, the previous definition would be replaced with one that had the <code class="docutils literal notranslate"><span class="pre">configure-archives</span></code> option set. To see the full set of options available run the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psconfig</span> <span class="n">remote</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>In addition to adding remote templates, you may also view them. The following command lists the remote templates in use by the agent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psconfig</span> <span class="n">remote</span> <span class="nb">list</span>
</pre></div>
</div>
<p>The above command returns a list of JSON objects containing the template URL and any options set.</p>
<p>Finally, to remove our example remote template we can run the <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span> <span class="pre">delete</span></code> command <strong>as a root user</strong> as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psconfig</span> <span class="n">remote</span> <span class="n">delete</span> <span class="s2">&quot;https://10.0.0.1/example.json&quot;</span>
</pre></div>
</div>
<p>The command accepts only a URL and will remove the agent’s pointer to that template. Within 60 seconds of executing that command, the agent will run and begin canceling any tasks from the removed template that it was responsible for creating.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span></code> command is also the command used by other agents to manage remote templates. If you have both agents installed on the same system, then any <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span></code> command will affect both agents by default. If you’d only like a command to apply to the pScheduler agent then add the <code class="docutils literal notranslate"><span class="pre">--agent</span> <span class="pre">pscheduler</span></code> option. Run <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span> <span class="pre">--help</span></code> for full details.</p>
</div>
</section>
<section id="local-templates">
<span id="psconfig-pscheduler-agent-templates-local"></span><h3>Local Templates<a class="headerlink" href="#local-templates" title="Permalink to this heading">¶</a></h3>
<p>The agent can read templates from the local filesystem. One way to do this is by giving the <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span></code> command either a URL beginning with <code class="docutils literal notranslate"><span class="pre">file://</span></code> or an absolute path to the file on the filesystem. An example command is below where <code class="docutils literal notranslate"><span class="pre">/path/to/template.json</span></code> is the example path to the template file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psconfig</span> <span class="n">remote</span> <span class="n">add</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">template</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Everything about the command works the same with a file path as it would with a http/https URL. See <a class="reference internal" href="#psconfig-pscheduler-agent-templates-remote"><span class="std std-ref">Remote Templates</span></a> for more details on this command.</p>
<p>A second way you can add a local template is to copy it into the <em>template include directory</em>. By default this is located at <code class="docutils literal notranslate"><span class="pre">/etc/perfsonar/psconfig/pscheduler.d/</span></code>. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">template</span><span class="o">.</span><span class="n">json</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">psconfig</span><span class="o">/</span><span class="n">pscheduler</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">template</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Any file ending with <code class="docutils literal notranslate"><span class="pre">.json</span></code> in this directory will get read by the agent automatically. Some important notes about including files in this manner:</p>
<ul class="simple">
<li><p>Adding a new file, removing a file or updating a file within the template include directory will get detected automatically by the agent within 60 seconds of the change (i.e. no need to restart the agent).</p></li>
<li><p>Files are read every 60 minutes regardless of changes when the agent checks on the state of the tasks it has created in pScheduler.</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">archives</span></code> defined for the tasks will be configured. This is equivalent to the behavior of running <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span> <span class="pre">add</span></code> with the <code class="docutils literal notranslate"><span class="pre">-configure-archives</span></code> option. If you do not want to use archives from the template, then remove them from the template file.</p></li>
<li><p>The agent will follow symlinks if you use those instead of copying the file directly, though it may affect the agent’s ability to detect changes (i.e. you may have to wait up to 60 minutes for the agent to see the changes).</p></li>
<li><p>The agent ignores any files that do not end in <code class="docutils literal notranslate"><span class="pre">.json</span></code></p></li>
</ul>
</section>
</section>
<section id="modifying-templates">
<span id="psconfig-pscheduler-agent-modify"></span><h2>Modifying Templates<a class="headerlink" href="#modifying-templates" title="Permalink to this heading">¶</a></h2>
<section id="configuring-default-archives">
<span id="psconfig-pscheduler-agent-modify-archives"></span><h3>Configuring Default Archives<a class="headerlink" href="#configuring-default-archives" title="Permalink to this heading">¶</a></h3>
<p>The agent can modify all tasks it manages to include additional archives not defined in the templates themselves. This can be done by copying archive definition files to the <em>archive include directory</em>. The default location of the <em>archive include directory</em> is <code class="docutils literal notranslate"><span class="pre">/etc/perfsonar/psconfig/archives.d/</span></code>.</p>
<p>Archive definition files are JSON files that contain exactly one <a class="reference internal" href="pscheduler_ref_archivers.html#pscheduler-ref-archivers-archivers"><span class="std std-ref">pScheduler archive definition</span></a>. For example, let’s say the file <code class="docutils literal notranslate"><span class="pre">/path/to/archive-syslog.json</span></code> contains the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;archiver&quot;</span><span class="p">:</span> <span class="s2">&quot;syslog&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;facility&quot;</span><span class="p">:</span> <span class="s2">&quot;local6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="s2">&quot;info&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can copy this file to <code class="docutils literal notranslate"><span class="pre">/etc/perfsonar/psconfig/archives.d/</span></code> as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">archive</span><span class="o">-</span><span class="n">syslog</span><span class="o">.</span><span class="n">json</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">psconfig</span><span class="o">/</span><span class="n">archives</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">archive</span><span class="o">-</span><span class="n">syslog</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Once copied, the agent will detect the change within 60 seconds. It will then recreate all the tasks it manages to include the archive defined above. You may include as many archive files in this directory as needed and all of them will be included with every task. A few other important notes:</p>
<ul class="simple">
<li><p>Adding a new file, removing a file or updating a file within the archive include directory will get detected automatically by the agent within 60 seconds of the change (i.e. no need to restart the agent).</p></li>
<li><p>Files are read every 60 minutes regardless of changes when the agent checks on the state of the tasks it’s created in pScheduler.</p></li>
<li><p>The agent will follow symlinks if you use those instead of copying the file directly, though it may affect the agent’s ability to detect changes (i.e. you may have to wait up to 60 minutes for the agent to see the changes).</p></li>
<li><p>The agent ignores any files that do not end in <code class="docutils literal notranslate"><span class="pre">.json</span></code>.</p></li>
</ul>
</section>
<section id="transforming-all-remote-templates">
<span id="psconfig-pscheduler-agent-modify-transform-all"></span><h3>Transforming All Remote Templates<a class="headerlink" href="#transforming-all-remote-templates" title="Permalink to this heading">¶</a></h3>
<p>The agent can make custom local modifications to templates it reads using <em>transform scripts</em>. Transform scripts take the form of <a class="reference external" href="https://stedolan.github.io/jq/">jq</a> and give complete freedom to manipulate the JSON. This can be especially useful with remote templates where the agent administrator may not have the ability to make changes. Some changes you may consider making with transform scripts include (but are not limited to):</p>
<ul class="simple">
<li><p>Updating authentication tokens needed by an <em>archive</em> object that cannot be safely published in a publicly available template</p></li>
<li><p>Updating parameters related to ports in a <em>test</em> object’s <code class="docutils literal notranslate"><span class="pre">spec</span></code> property if your local site has specific firewall restriction not applicable to other hosts running agents</p></li>
<li><p>Adding additional <code class="docutils literal notranslate"><span class="pre">reference</span></code> information to a template <em>task</em> object so the generated pScheduler tasks contain extra metadata specific to the agent’s host</p></li>
</ul>
<p>All components of the template JSON can be revised which creates countless possibilities. For transform scripts that you want to apply to ALL templates read by the agent, including both those added with <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span></code> and those added from the template include directory, you can add a file to the <em>transforms include directory</em>. This directory is located at  <code class="docutils literal notranslate"><span class="pre">/etc/perfsonar/psconfig/transforms.d</span></code> by default. The script takes the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;script&quot;</span><span class="p">:</span> <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">...</span></code> can either be a jq statement as a string or it can be an array of strings used for readability. The example below uses the array form to define a script that sets the <code class="docutils literal notranslate"><span class="pre">_Authorization</span></code> field to <code class="docutils literal notranslate"><span class="pre">Basic</span> <span class="pre">eXamPleTokEn</span></code> of an archiver named <code class="docutils literal notranslate"><span class="pre">example-archive-central</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;script&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;if .archives.</span><span class="se">\&quot;</span><span class="s2">example-archive-central</span><span class="se">\&quot;</span><span class="s2"> then&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    .archives.</span><span class="se">\&quot;</span><span class="s2">example-archive-central</span><span class="se">\&quot;</span><span class="s2">.data.</span><span class="se">\&quot;</span><span class="s2">_headers</span><span class="se">\&quot;</span><span class="s2">.Authorization |= </span><span class="se">\&quot;</span><span class="s2">Basic eXamPleTokEn</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;else&quot;</span><span class="p">,</span>
        <span class="s2">&quot;    .&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end&quot;</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If we say the script above lives in <code class="docutils literal notranslate"><span class="pre">/path/to/logstash-auth.json</span></code> we can add it to the agent as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">logstash</span><span class="o">-</span><span class="n">auth</span><span class="o">.</span><span class="n">json</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">psconfig</span><span class="o">/</span><span class="n">transforms</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">logstash</span><span class="o">-</span><span class="n">auth</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Once copied, the agent will detect the change within 60 seconds. It will then re-read all the templates, apply the script to each, and recreate any tasks that were altered by the transformation. A few other important notes:</p>
<ul class="simple">
<li><p>Adding a new file, removing a file or updating a file within the transforms include directory will get detected automatically by the agent within 60 seconds of the change (i.e. no need to restart the agent).</p></li>
<li><p>Files are read every 60 minutes regardless of changes when the agent checks on the state of the tasks it’s created in pScheduler.</p></li>
<li><p>The agent will follow symlinks if you use those instead of copying the file directly, though it may affect the agent’s ability to detect changes (i.e. you may have to wait up to 60 minutes for the agent to see the changes).</p></li>
<li><p>The agent ignores any files that do not end in <code class="docutils literal notranslate"><span class="pre">.json</span></code>.</p></li>
</ul>
</section>
<section id="transforming-individual-remote-templates">
<span id="psconfig-pscheduler-agent-modify-transform-one"></span><h3>Transforming Individual Remote Templates<a class="headerlink" href="#transforming-individual-remote-templates" title="Permalink to this heading">¶</a></h3>
<p>It is possible to make custom local modification to <em>individual</em> templates added with <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span></code> using the <code class="docutils literal notranslate"><span class="pre">--transform</span></code> option. This is useful if you do not want a script affecting everything read by an agent.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Templates added using the template include directory cannot be transformed individually. An agent administrator can apply default transformations to them as detailed in <a class="reference internal" href="#psconfig-pscheduler-agent-modify-transform-all"><span class="std std-ref">Transforming All Remote Templates</span></a> or make the change manually since the administrator presumably has access to the local template.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--transform</span></code> option accepts either a <a class="reference external" href="https://stedolan.github.io/jq/">jq</a> script as a string or from a file. For the later approach, if the option starts with <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> it will read the file specified by the path after the <code class="docutils literal notranslate"><span class="pre">&#64;</span></code>. The example below shows the form where the script is provided as a string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psconfig</span> <span class="n">remote</span> <span class="n">add</span> <span class="o">--</span><span class="n">transform</span> <span class="s2">&quot;if .archives.</span><span class="se">\&quot;</span><span class="s2">example-archive-central</span><span class="se">\&quot;</span><span class="s2"> then .archives.</span><span class="se">\&quot;</span><span class="s2">example-archive-central</span><span class="se">\&quot;</span><span class="s2">.data.</span><span class="se">\&quot;</span><span class="s2">_auth-token</span><span class="se">\&quot;</span><span class="s2"> |= </span><span class="se">\&quot;</span><span class="s2">ABC123</span><span class="se">\&quot;</span><span class="s2"> else . end&quot;</span> <span class="s2">&quot;https://10.0.0.1/example.json&quot;</span>
</pre></div>
</div>
<p>Alternatively, if we assume our script lives in a file at <code class="docutils literal notranslate"><span class="pre">/path/to/logstash-auth.json</span></code> with the format described in <a class="reference internal" href="#psconfig-pscheduler-agent-modify-transform-all"><span class="std std-ref">Transforming All Remote Templates</span></a>, we can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psconfig</span> <span class="n">remote</span> <span class="n">add</span> <span class="o">--</span><span class="n">transform</span> <span class="o">@/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">logstash</span><span class="o">-</span><span class="n">auth</span><span class="o">.</span><span class="n">json</span> <span class="s2">&quot;https://10.0.0.1/example.json&quot;</span>
</pre></div>
</div>
<p>In both cases you can run <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span> <span class="pre">list</span></code> to verify the transform is in the remote definition.</p>
</section>
</section>
<section id="troubleshooting">
<span id="psconfig-pscheduler-agent-troubleshoot"></span><h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading">¶</a></h2>
<section id="looking-at-the-last-run-with-psconfig-stats-pscheduler">
<span id="psconfig-pscheduler-agent-troubleshoot-stats"></span><h3>Looking at the last run with <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">stats</span> <span class="pre">pscheduler</span></code><a class="headerlink" href="#looking-at-the-last-run-with-psconfig-stats-pscheduler" title="Permalink to this heading">¶</a></h3>
<p>One of the first steps to perform when debugging the pSConfig pScheduler agent is to get information about the last time the agent ran. A run in this context describes an instance when pSConfig downloaded all the templates it is configured to use, made any local modifications and determined which tasks that need to be created and/or removed from the pScheduler servers with which it interacts. As described in <a class="reference internal" href="#psconfig-pscheduler-agent-intro-role"><span class="std std-ref">pSConfig pScheduler Agent’s Role</span></a>, a run can be triggered by the passing of a set time interval (60 minutes by default) or a configuration file change.</p>
<p>Rather than manually digging through logs, pSConfig provides a tool for parsing summary information about the last run in the form of the <a href="#id2"><span class="problematic" id="id3">``</span></a>psconfig stats pscheduler `` command. The command does not require any options and is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psconfig</span> <span class="n">stats</span> <span class="n">pscheduler</span>
</pre></div>
</div>
<p>Below is an example of the successful output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Agent</span> <span class="n">Last</span> <span class="n">Run</span> <span class="n">Start</span> <span class="n">Time</span><span class="p">:</span> <span class="mi">2018</span><span class="o">/</span><span class="mi">04</span><span class="o">/</span><span class="mi">24</span> <span class="mi">19</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">54</span>
<span class="n">Agent</span> <span class="n">Last</span> <span class="n">Run</span> <span class="n">End</span> <span class="n">Time</span><span class="p">:</span> <span class="mi">2018</span><span class="o">/</span><span class="mi">04</span><span class="o">/</span><span class="mi">24</span> <span class="mi">19</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">04</span>
<span class="n">Agent</span> <span class="n">Last</span> <span class="n">Run</span> <span class="n">Process</span> <span class="n">ID</span> <span class="p">(</span><span class="n">PID</span><span class="p">):</span> <span class="mi">6026</span>
<span class="n">Agent</span> <span class="n">Last</span> <span class="n">Run</span> <span class="n">Log</span> <span class="n">GUID</span><span class="p">:</span> <span class="n">DD85D234</span><span class="o">-</span><span class="mi">47</span><span class="n">F5</span><span class="o">-</span><span class="mf">11E8</span><span class="o">-</span><span class="n">B2F1</span><span class="o">-</span><span class="mi">3613118410</span><span class="n">B6</span>
<span class="n">Total</span> <span class="n">tasks</span> <span class="n">managed</span> <span class="n">by</span> <span class="n">agent</span><span class="p">:</span> <span class="mi">8</span>
<span class="n">From</span> <span class="n">include</span> <span class="n">files</span><span class="p">:</span> <span class="mi">5</span>
    <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">psconfig</span><span class="o">/</span><span class="n">pscheduler</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">template</span><span class="o">.</span><span class="n">json</span><span class="p">:</span> <span class="mi">5</span>
<span class="n">From</span> <span class="n">remote</span> <span class="n">definitions</span><span class="p">:</span> <span class="mi">3</span>
    <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">10.0.0.1</span><span class="o">/</span><span class="n">example</span><span class="o">.</span><span class="n">json</span><span class="p">:</span> <span class="mi">3</span>
</pre></div>
</div>
<p>The output fields can be described as follows:</p>
<ul class="simple">
<li><p><strong>Agent Last Run Start Time</strong> is the time when the agent began its last complete run.</p></li>
<li><p><strong>Agent Last Run End Time</strong> is the time when the last complete run ended.</p></li>
<li><p><strong>Agent Last Run Process ID (PID)</strong> is the process ID of the agent at the time of its last complete run. This should only change if the agent is restarted.</p></li>
<li><p><strong>Agent Last Run Log GUID</strong> is a globally unique ID used to identify a run in the logs. You can grep the <a class="reference internal" href="#psconfig-pscheduler-agent-troubleshoot-logs"><span class="std std-ref">log files</span></a> with this ID to get the information about a specific run.</p></li>
<li><p><strong>Total tasks managed by agent</strong> is the number of tasks the agent is responsible for managing. This is not necessarily the total number that were created the last run, but it is the number of tasks it is monitoring and managing across all pScheduler servers.</p></li>
<li><p><strong>From include files</strong> is a count of the number of tasks that come from templates in the template include directory. Directly underneath that is a breakdown of the task count by the file from which they originate.</p></li>
<li><p><strong>From remote definitions</strong> is a count of the number of tasks that come from URLs added using the <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">remote</span></code> command. Underneath is a breakdown of the task count by URL.</p></li>
</ul>
<p>This command is useful as a quick health check of the agent. It can answer questions like:</p>
<ul class="simple">
<li><p>When did my agent last run?</p></li>
<li><p>What templates is it using?</p></li>
<li><p>Is it managing the tasks I expect it to manage?</p></li>
</ul>
<p>Also, if it throws an error that can be useful information too. In particular the output below is a good sign that your agent has never ran since it has not created the necessary log file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Unable</span> <span class="n">to</span> <span class="nb">open</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">psconfig</span><span class="o">-</span><span class="n">pscheduler</span><span class="o">-</span><span class="n">agent</span><span class="o">.</span><span class="n">log</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span>
</pre></div>
</div>
<p>This script may not give all the answers, but will hopefully get things started when debugging unexpected behavior of the agent.</p>
</section>
<section id="viewing-managed-pscheduler-tasks-with-psconfig-pscheduler-tasks">
<span id="psconfig-pscheduler-agent-troubleshoot-tasks"></span><h3>Viewing Managed pScheduler Tasks with <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">pscheduler-tasks</span></code><a class="headerlink" href="#viewing-managed-pscheduler-tasks-with-psconfig-pscheduler-tasks" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">pscheduler-tasks</span></code> command provides a JSON list of pScheduler tasks managed by the pSConfig pScheduler agent. It parses the file <code class="docutils literal notranslate"><span class="pre">/var/log/perfsonar/psconfig-pscheduler-agent-tasks.log</span></code> for all the tasks found in the last run. It does not require any options and can be run as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psconfig</span> <span class="n">pscheduler</span><span class="o">-</span><span class="n">tasks</span>
</pre></div>
</div>
<p>Example output of an agent managing three tasks is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;tasks&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;archives&quot;</span> <span class="p">:</span> <span class="p">[],</span>
         <span class="s2">&quot;test&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;spec&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="s2">&quot;source&quot;</span> <span class="p">:</span> <span class="s2">&quot;10.0.0.10&quot;</span><span class="p">,</span>
               <span class="s2">&quot;dest&quot;</span> <span class="p">:</span> <span class="s2">&quot;10.0.0.11&quot;</span><span class="p">,</span>
               <span class="s2">&quot;duration&quot;</span> <span class="p">:</span> <span class="s2">&quot;PT30S&quot;</span><span class="p">,</span>
               <span class="s2">&quot;schema&quot;</span> <span class="p">:</span> <span class="mi">1</span>
            <span class="p">},</span>
            <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;throughput&quot;</span>
         <span class="p">},</span>
         <span class="s2">&quot;reference&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;psconfig&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="s2">&quot;created-by&quot;</span> <span class="p">:</span> <span class="p">{</span>
                  <span class="s2">&quot;user-agent&quot;</span> <span class="p">:</span> <span class="s2">&quot;psconfig-pscheduler-agent&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;uuid&quot;</span> <span class="p">:</span> <span class="s2">&quot;E0E9389A-1748-11E8-A7FE-65A6AE5B70B2&quot;</span>
               <span class="p">}</span>
            <span class="p">}</span>
         <span class="p">},</span>
         <span class="s2">&quot;schema&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s2">&quot;schedule&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;until&quot;</span> <span class="p">:</span> <span class="s2">&quot;2018-04-25T19:29:54Z&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sliprand&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;repeat&quot;</span> <span class="p">:</span> <span class="s2">&quot;PT4H&quot;</span><span class="p">,</span>
            <span class="s2">&quot;slip&quot;</span> <span class="p">:</span> <span class="s2">&quot;PT4H&quot;</span>
         <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;archives&quot;</span> <span class="p">:</span> <span class="p">[],</span>
         <span class="s2">&quot;test&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;spec&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="s2">&quot;source&quot;</span> <span class="p">:</span> <span class="s2">&quot;10.0.0.10&quot;</span><span class="p">,</span>
               <span class="s2">&quot;dest&quot;</span> <span class="p">:</span> <span class="s2">&quot;10.0.0.11&quot;</span><span class="p">,</span>
               <span class="s2">&quot;schema&quot;</span> <span class="p">:</span> <span class="mi">1</span>
            <span class="p">},</span>
            <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;trace&quot;</span>
         <span class="p">},</span>
         <span class="s2">&quot;reference&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;psconfig&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="s2">&quot;created-by&quot;</span> <span class="p">:</span> <span class="p">{</span>
                  <span class="s2">&quot;user-agent&quot;</span> <span class="p">:</span> <span class="s2">&quot;psconfig-pscheduler-agent&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;uuid&quot;</span> <span class="p">:</span> <span class="s2">&quot;E0E9389A-1748-11E8-A7FE-65A6AE5B70B2&quot;</span>
               <span class="p">}</span>
            <span class="p">}</span>
         <span class="p">},</span>
         <span class="s2">&quot;schema&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s2">&quot;schedule&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;sliprand&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;repeat&quot;</span> <span class="p">:</span> <span class="s2">&quot;PT10M&quot;</span><span class="p">,</span>
            <span class="s2">&quot;slip&quot;</span> <span class="p">:</span> <span class="s2">&quot;PT10M&quot;</span>
         <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;archives&quot;</span> <span class="p">:</span> <span class="p">[],</span>
         <span class="s2">&quot;test&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;spec&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="s2">&quot;source&quot;</span> <span class="p">:</span> <span class="s2">&quot;10.0.0.10&quot;</span><span class="p">,</span>
               <span class="s2">&quot;dest&quot;</span> <span class="p">:</span> <span class="s2">&quot;10.0.0.11&quot;</span><span class="p">,</span>
               <span class="s2">&quot;schema&quot;</span> <span class="p">:</span> <span class="mi">1</span>
            <span class="p">},</span>
            <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;latencybg&quot;</span>
         <span class="p">},</span>
         <span class="s2">&quot;reference&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;psconfig&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="s2">&quot;created-by&quot;</span> <span class="p">:</span> <span class="p">{</span>
                  <span class="s2">&quot;user-agent&quot;</span> <span class="p">:</span> <span class="s2">&quot;psconfig-pscheduler-agent&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;uuid&quot;</span> <span class="p">:</span> <span class="s2">&quot;E0E9389A-1748-11E8-A7FE-65A6AE5B70B2&quot;</span>
               <span class="p">}</span>
            <span class="p">}</span>
         <span class="p">},</span>
         <span class="s2">&quot;schema&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s2">&quot;schedule&quot;</span> <span class="p">:</span> <span class="p">{}</span>
      <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This list includes all the tasks it manages, not necessarily the list created by the last run. It also does not guarantee that they were successfully scheduled in pScheduler. What it does provide though is the agent’s perspective on the tasks that it tries to create and maintain. Matching this list to what is actually in pScheduler is often crucial to debugging and this command provides a view into the agent’s side of that information.</p>
</section>
<section id="reading-the-logs">
<span id="psconfig-pscheduler-agent-troubleshoot-logs"></span><h3>Reading the Logs<a class="headerlink" href="#reading-the-logs" title="Permalink to this heading">¶</a></h3>
<p>If you need to debug beyond what the utilities above provide from the logs, then you can manually look at the log files.There are three important logs used by the agent:</p>
<blockquote>
<div><ul class="simple">
<li><p>The <strong>agent log</strong> lives at <code class="docutils literal notranslate"><span class="pre">/var/log/perfsonar/psconfig-pscheduler-agent.log</span></code> and tracks basic information about agent activity and any errors encountered. This is often the first log to review when debugging as it is not as verbose as the others and provides a quick summary of the agent’s actions.</p></li>
<li><p>The <strong>task log</strong> lives at <code class="docutils literal notranslate"><span class="pre">/var/log/perfsonar/psconfig-pscheduler-agent-tasks.log</span></code> and tracks the pScheduler tasks the agent manages. This is where the <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">pscheduler-tasks</span></code> <a class="reference internal" href="#psconfig-pscheduler-agent-troubleshoot-tasks"><span class="std std-ref">command</span></a> gets the information it displays. This log is useful if you need to look at how pSConfig is defining tasks it gives (or tries to give) to pScheduler.</p></li>
<li><p>The <strong>transaction log</strong> lives at <code class="docutils literal notranslate"><span class="pre">/var/log/perfsonar/psconfig-pscheduler-agent-transactions.log</span></code> and logs each individual interaction with pScheduler. Every request to list, create and delete tasks is shown in this log. Each line provides context such as the action being performed, the pScheduler server URL and the raw JSON sent/received from the server. This log is intended to be verbose and useful when intricate debugging is needed.</p></li>
</ul>
</div></blockquote>
<p>All of the logs are designed to by highly parsable with fields in the form of <code class="docutils literal notranslate"><span class="pre">key=value</span></code> separated by whitespace. Every line has a <code class="docutils literal notranslate"><span class="pre">guid=</span></code> field with an ID unique to the run of an agent. This ID is consistent between log files and is incredibly useful for linking events seen in separate logs.</p>
<p>As an example, the GUID can be used for filtering log lines across files with <code class="docutils literal notranslate"><span class="pre">grep</span></code> or similar tools.  It is often easiest to run the <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">stats</span> <span class="pre">pscheduler</span></code> <a class="reference internal" href="#psconfig-pscheduler-agent-troubleshoot-stats"><span class="std std-ref">command</span></a> to get the GUID of the last run as a launching point to parse the logs. For example, looking at the example output from <a class="reference internal" href="#psconfig-pscheduler-agent-troubleshoot-stats"><span class="std std-ref">Looking at the last run with psconfig stats pscheduler</span></a>, the run had a GUID of <code class="docutils literal notranslate"><span class="pre">DD85D234-47F5-11E8-B2F1-3613118410B6</span></code>. Knowing this GUID, all the log messages associated with that run can be queried using a command like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grep</span> <span class="s2">&quot;guid=DD85D234-47F5-11E8-B2F1-3613118410B6&quot;</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">psconfig</span><span class="o">-</span><span class="n">pscheduler</span><span class="o">-*.</span><span class="n">log</span>
</pre></div>
</div>
<p>You can further filter that output if needed, and hopefully eventually find the information needed to solve any issues encountered.</p>
</section>
</section>
<section id="advanced-configuration">
<span id="psconfig-pscheduler-agent-advanced"></span><h2>Advanced Configuration<a class="headerlink" href="#advanced-configuration" title="Permalink to this heading">¶</a></h2>
<p>The primary configuration file for the agent lives in <code class="docutils literal notranslate"><span class="pre">/etc/perfsonar/psconfig/pscheduler-agent.json</span></code>. It provides a number of options for fine-tuning your agent such as how often to download remote templates, the address of the pScheduler assist server, and more. The best way to edit the file is with the <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">agentctl</span></code> command. You can get a full list of options supported by the agent with the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>psconfig agentctl pscheduler ?
</pre></div>
</div>
<p>For full details on how to use the <cite>psconfig agentctl</cite> command to display, set, and unset properties run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psconfig</span> <span class="n">agentctl</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
</section>
<section id="further-reading">
<span id="psconfig-pscheduler-agent-reading"></span><h2>Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>For a full listing of pSConfig pScheduler Agent related files see the reference <a class="reference internal" href="config_files.html#config-files-psconfig"><span class="std std-ref">here</span></a></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <nav id="channelNav" class="channelNav">
                
                <ul>
<li><a class="reference internal" href="#">Running the pSConfig pScheduler Agent</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#psconfig-pscheduler-agent-s-role">pSConfig pScheduler Agent’s Role</a></li>
<li><a class="reference internal" href="#reading-and-modifying-templates">Reading and Modifying Templates</a></li>
<li><a class="reference internal" href="#determining-the-pscheduler-tasks-to-create">Determining the pScheduler Tasks to Create</a></li>
<li><a class="reference internal" href="#communicating-with-pscheduler">Communicating with pScheduler</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#installing-the-standalone-package">Installing the Standalone Package</a></li>
<li><a class="reference internal" href="#installing-as-part-of-a-bundle">Installing as Part of a Bundle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-psconfig-pscheduler-agent">Running <code class="docutils literal notranslate"><span class="pre">psconfig-pscheduler-agent</span></code></a><ul>
<li><a class="reference internal" href="#starting-psconfig-pscheduler-agent">Starting <code class="docutils literal notranslate"><span class="pre">psconfig-pscheduler-agent</span></code></a></li>
<li><a class="reference internal" href="#stopping-psconfig-pscheduler-agent">Stopping <code class="docutils literal notranslate"><span class="pre">psconfig-pscheduler-agent</span></code></a></li>
<li><a class="reference internal" href="#restarting-psconfig-pscheduler-agent">Restarting <code class="docutils literal notranslate"><span class="pre">psconfig-pscheduler-agent</span></code></a></li>
<li><a class="reference internal" href="#checking-the-status-of-psconfig-pscheduler-agent">Checking the status of <code class="docutils literal notranslate"><span class="pre">psconfig-pscheduler-agent</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-templates">Configuring Templates</a><ul>
<li><a class="reference internal" href="#configuration-basics">Configuration Basics</a></li>
<li><a class="reference internal" href="#remote-templates">Remote Templates</a></li>
<li><a class="reference internal" href="#local-templates">Local Templates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modifying-templates">Modifying Templates</a><ul>
<li><a class="reference internal" href="#configuring-default-archives">Configuring Default Archives</a></li>
<li><a class="reference internal" href="#transforming-all-remote-templates">Transforming All Remote Templates</a></li>
<li><a class="reference internal" href="#transforming-individual-remote-templates">Transforming Individual Remote Templates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#looking-at-the-last-run-with-psconfig-stats-pscheduler">Looking at the last run with <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">stats</span> <span class="pre">pscheduler</span></code></a></li>
<li><a class="reference internal" href="#viewing-managed-pscheduler-tasks-with-psconfig-pscheduler-tasks">Viewing Managed pScheduler Tasks with <code class="docutils literal notranslate"><span class="pre">psconfig</span> <span class="pre">pscheduler-tasks</span></code></a></li>
<li><a class="reference internal" href="#reading-the-logs">Reading the Logs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-configuration">Advanced Configuration</a></li>
<li><a class="reference internal" href="#further-reading">Further Reading</a></li>
</ul>
</li>
</ul>

                <ul>
                  <li>
                  <a href="psconfig_publish.html">Previous topic</a>
                  <ul><li><a href="psconfig_publish.html" title="previous chapter">Publishing a pSConfig Template</a></li></ul>
                  </li>
                </ul>
                  <ul>
                      <li>
                      <a href="psconfig_grafana_agent.html">Next topic</a>
                      <ul><li><a href="psconfig_grafana_agent.html" title="next chapter">Running the pSConfig Grafana Agent</a></li></ul>
                      </li>
                  </ul>
                
                
            </nav>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="psconfig_grafana_agent.html" title="Running the pSConfig Grafana Agent"
             >next</a> |</li>
        <li class="right" >
          <a href="psconfig_publish.html" title="Publishing a pSConfig Template"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">perfSONAR Toolkit 5.1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Running the pSConfig pScheduler Agent</a></li> 
      </ul>
    </div>
    <footer id="fat">
        <div class="footerContents">
            <nav id="fatFooterNav" class="fatFooterNav">
                <ul id="menu-partners" class="menu depth-0">
                    <li id="footer-partner-text" class="partner-menu">
                        perfSONAR 
                        <br>
                        partners 
                        <br>
                        include: 
                    </li>
    
                <li id="footer-partner-esnet" class="partner-menu">
                    <a href="http://www.es.net/" title="Visit DOE's Energy Sciences Network"><img src="_static/ESnet-ps.png" alt="" style="border:none;"></a> </li>
                
                <li id="footer-partner-geant" class="partner-menu">
                    <a href="http://www.geant.org/" title="Visit GEANT"><img src="_static/geant-ps.png" alt="" style="border:none;"/></a> </li>
        
                <li id="footer-partner-iu" class="partner-menu">
                    <a href="http://www.iu.edu/" title="Visit Indiana University"><img src="_static/IU-ps.png" alt="" style="border:none;"></a> </li>

                <li id="footer-partner-i2" class="partner-menu">
                    <a href="http://www.internet2.edu/" title="Visit Internet2"><img src="_static/I2-ps.png" alt="" style="border:none;"></a> </li>
					
				<li id="footer-partner-rnp" class="partner-menu">
                    <a href="https://www.rnp.br/en" title="Visit RNP"><img src="_static/rnp.png" alt="" style="border:none;"></a> </li>
                
                <li id="footer-partner-um" class="partner-menu">
                    <a href="http://www.umich.edu/" title="Visit University of Michigan"><img src="_static/UM-ps.png" alt="" style="border:none;"></a> </li>

                </ul>

            </nav>
            <nav id="minFooterNav" class="minFooterNav">
                <span class="copyright">PERFormance Service Oriented Network monitoring ARchitecture </span>
            </nav>
          
        </div> <!-- /footerContents -->
    </footer>
    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2024, perfSONAR Project.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
  </body>
</html>