
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pSConfig Auto-Configuration &#8212; perfSONAR Toolkit 4.1.6 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/perfsonar.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MeshConfig to pSConfig Migration Guide" href="psconfig_meshconfig_migrate.html" />
    <link rel="prev" title="Advanced pSConfig Templates" href="psconfig_templates_advanced.html" /> 
  </head><body>
    <header>
        <div class="headerContents">
          <a href="index.html" border="0"><img src="_static/perfSONAR-header.gif"></a>
          <div class="acctSearchContainer">
              <section id="searchBox" class="searchBox">
                  <!--Use of this code assumes agreement with the Google Custom Search Terms of Service. -->
                  <!--The terms of service are available at http://www.google.com/cse/docs/tos.html -->
                  <form action="search.html" id="cse-search-box" method="get">
                    <input type="text" name="q" size="25" class="searchInput" placeholder="Search"/>
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                  </form>
              </section>
         </div>
        </div>
    </header>
    <div style="display:block;clear:both;">
    
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="psconfig_meshconfig_migrate.html" title="MeshConfig to pSConfig Migration Guide"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="psconfig_templates_advanced.html" title="Advanced pSConfig Templates"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">perfSONAR Toolkit 4.1.6 documentation</a> &#187;</li> 
      </ul>
    </div>
    </div>
    
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="psconfig-auto-configuration">
<h1>pSConfig Auto-Configuration<a class="headerlink" href="#psconfig-auto-configuration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="note-this-page-has-not-been-updated-for-4-1-still-under-construction">
<h2>NOTE: THIS PAGE HAS NOT BEEN UPDATED FOR 4.1. STILL UNDER CONSTRUCTION.<a class="headerlink" href="#note-this-page-has-not-been-updated-for-4-1-still-under-construction" title="Permalink to this headline">¶</a></h2>
<p>If you have a very large mesh or a mesh that frequently is adding and removing test members, then it may become cumbersome to manually update your tests. For this reason the perfSONAR MeshConfig software has the concept of <em>automatic test configuration</em>.</p>
<p>Automatic test configuration’s goal is NOT zero configuration, instead the idea is that there will be some initial configuration steps performed on a server hosting the MeshConfig that describes the tests in a general sense as opposed to explicitly naming each host that will be involved in a test. The MeshConfig provides constructs in the form of <em>host classes</em> and <em>tags</em> in support of this idea. See <a class="reference internal" href="#multi-mesh-autoconfig-classes"><span class="std std-ref">Introducing Host Classes and Tags</span></a> for more information on these constructs.</p>
<p>Once this initial configuration has taken place, each new host can simply point at this central file and know the tests to run <em>without the administrator of the central mesh configuration file having to update the mesh every time a new host is added</em> (this last part is what distinguishes it from a traditional MeshConfig setup). The configuration on the end host should also be minimized (though again it will be greater than zero). The configuration primarily consists of pointing at the URL where the central mesh lives (and perhaps optionally pointing at a private lookup service).</p>
<p>The individual client configurations are simplified even further by using external configuration management software such as <a class="reference external" href="https://puppetlabs.com">Puppet</a> or similar. Essentially the configuration management software of your choice will need to copy one or two (depending on your use case) configuration files to each new host. See our document on using the <span class="xref std std-doc">perfSONAR Puppet module</span> for more information on using this type of setup with puppet specifically or for ideas on how to integrate with another configuration managements software of your choosing.</p>
<p>Once you have the basic ideas, there are a few common setups worth discussing further. First, using automated testing  constructs you can develop a simple automated configuration that tests to a fixed set of endpoints. For example, every new host that comes up may always test to the same two hosts, not aware of any other host that comes-up. See <a class="reference internal" href="#multi-mesh-autoconfig-fixed"><span class="std std-ref">Testing to a Fixed Set of Target Hosts</span></a> for more details.</p>
<p>You may also go even further and build a dynamic list of hosts from the perfSONAR Lookup Service. In this configuration, new nodes are discovered by other nodes in the mesh and the endpoint to which they test are changed accordingly. For information on this configuration, see <a class="reference internal" href="#multi-mesh-autoconfig-dynamic"><span class="std std-ref">Testing to a Dynamic Set of Target Hosts</span></a>.</p>
</div>
<div class="section" id="introducing-host-classes-and-tags">
<span id="multi-mesh-autoconfig-classes"></span><h2>Introducing Host Classes and Tags<a class="headerlink" href="#introducing-host-classes-and-tags" title="Permalink to this headline">¶</a></h2>
<p>There are two main constructs that go into generating dynamic meshes: <em>host classes</em> and <em>tags</em>. Host classes allow you to describe criteria for a host and its addresses that you want in a test configuration. This is in contrast to the traditional case where you explicitly define the host. You then reference a class instead of a host address in your test groups allowing for any new hosts that match the defined criteria to automatically be included. Let’s take a look at a simple example that matches all IP addresses of hosts in the current mesh file with the subnet 10.0.1.0/24:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">my_subnet_class</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">current_mesh</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">netmask</span>
           <span class="n">netmask</span>   <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The example above contains the following structural parts common to all classes (see also <span class="xref std std-ref">config_mesh-dynamic_gen</span> for more details):</p>
<ul class="simple">
<li>The class <em>name</em> that identifies the class. We’ll use this later in a <span class="xref std std-ref">group</span> definition to indicate we want class members in a specific group.</li>
<li>The <em>data source</em> which indicates the initial list of hosts to filter against. In this case, we specified <em>current_mesh</em>, which means any host defined in this mesh or it’s include files. For other types of data sources see <span class="xref std std-ref">config_mesh-dynamic_sources</span>.</li>
<li>The <em>filters</em> in the form of a <em>match</em> block. The filter directives define the criteria a host must meet and the match directive indicates if the criteria are met to include ir in the mesh. Not shown is the <em>exclude</em> block which defines criteria for  hosts you want excluded for the mesh. For more information on the types of filters available see <span class="xref std std-ref">config_mesh-dynamic_filters</span>.</li>
</ul>
<p>Host classes allow for a lot of interesting selection criteria. They are made even more powerful though by the second construct: <em>tags</em>. Tags are custom labels you can add to any  <span class="xref std std-ref">organization</span>, <span class="xref std std-ref">site</span>, <span class="xref std std-ref">host</span>, or <span class="xref std std-ref">address</span> directive. You can then match against these using the <em>tag</em> filter in your host class. A common use case for this is to tag addresses designated for latency tests and those for throughput tests as such. If we extend our example above and assume that we have tagged addresses in the 10.0.1.0/24 as latency or throughput, we can define the following two classes to distinguish each:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">my_subnet_latency_class</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">current_mesh</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">netmask</span>
           <span class="n">netmask</span>   <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">tag</span>
           <span class="n">tag</span>    <span class="n">latency</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">my_subnet_throughput_class</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">current_mesh</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">netmask</span>
           <span class="n">netmask</span>   <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">tag</span>
           <span class="n">tag</span>    <span class="n">throughput</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Notice that each match block has two filters: one of type netmask and another of type tag. There is an implied AND condition between filters like this of different types.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can also explicitly define filters such as AND, OR and NOT. See <span class="xref std std-ref">config_mesh-dynamic_filters</span></p>
</div>
<p>This example really just focuses the host class and tag constructs. It is also not an exhaustive list of all the options available for each of these constructs. See the sections that follow for some further examples of the uses of these constructs.</p>
</div>
<div class="section" id="testing-to-a-fixed-set-of-target-hosts">
<span id="multi-mesh-autoconfig-fixed"></span><h2>Testing to a Fixed Set of Target Hosts<a class="headerlink" href="#testing-to-a-fixed-set-of-target-hosts" title="Permalink to this headline">¶</a></h2>
<p>Perhaps the simplest way to get started with automatic test configuration is having each each new tester test to a fixed set of locations. This test scenario is the right case for you if all of the following hold true:</p>
<ul class="simple">
<li>You want every dynamic tester to test to the same set of endpoints</li>
<li>You do not need each tester to know about the other automatically configured testers</li>
<li>You do not want your automatic tester to appear in a dashboard</li>
</ul>
<p>In order for this case to work you will need to define the appropriate directives in your <a class="reference internal" href="#multi-mesh-autoconfig-fixed-server"><span class="std std-ref">central MeshConfig file</span></a> and in the <a class="reference internal" href="#multi-mesh-autoconfig-fixed-client"><span class="std std-ref">agent configuration</span></a> of the new testers.</p>
<div class="section" id="meshconfig-server-configuration">
<span id="multi-mesh-autoconfig-fixed-server"></span><h3>MeshConfig Server Configuration<a class="headerlink" href="#meshconfig-server-configuration" title="Permalink to this headline">¶</a></h3>
<p>As an example, let’s use the following MeshConfig file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">description</span>      <span class="n">Example</span> <span class="n">Mesh</span>

<span class="o">&lt;</span><span class="n">organization</span><span class="o">&gt;</span>
  <span class="n">description</span>    <span class="n">Acme</span>

  <span class="o">&lt;</span><span class="n">site</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span>
      <span class="n">description</span>    <span class="n">host1</span><span class="o">.</span><span class="n">example</span>
      <span class="n">address</span>        <span class="n">host1</span><span class="o">.</span><span class="n">example</span>
    <span class="o">&lt;/</span><span class="n">host</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">site</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="n">site</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span>
      <span class="n">description</span>    <span class="n">host2</span><span class="o">.</span><span class="n">example</span>
      <span class="n">address</span>        <span class="n">host2</span><span class="o">.</span><span class="n">example</span>
    <span class="o">&lt;/</span><span class="n">host</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">site</span><span class="o">&gt;</span>

<span class="o">&lt;/</span><span class="n">organization</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">owamp_agents</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">requesting_agent</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">netmask</span>
           <span class="n">netmask</span>   <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">host_properties</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">measurement_archive</span><span class="o">&gt;</span>
        <span class="nb">type</span>        <span class="n">perfsonarbuoy</span><span class="o">/</span><span class="n">owamp</span>
        <span class="n">read_url</span>    <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ma</span><span class="o">.</span><span class="n">example</span><span class="o">/</span><span class="n">esmond</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">archive</span>
        <span class="n">write_url</span>   <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ma</span><span class="o">.</span><span class="n">example</span><span class="o">/</span><span class="n">esmond</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">archive</span>
      <span class="o">&lt;/</span><span class="n">measurement_archive</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">host_properties</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">group</span> <span class="n">owamp_group</span><span class="o">&gt;</span>
  <span class="nb">type</span>              <span class="n">disjoint</span>

  <span class="n">a_member</span>          <span class="n">host1</span><span class="o">.</span><span class="n">example</span>
  <span class="n">a_member</span>          <span class="n">host2</span><span class="o">.</span><span class="n">example</span>

  <span class="n">b_member</span>          <span class="n">host_class</span><span class="p">::</span><span class="n">owamp_agents</span>
<span class="o">&lt;/</span><span class="n">group</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">test_spec</span> <span class="n">owamp_test</span><span class="o">&gt;</span>
  <span class="nb">type</span>              <span class="n">perfsonarbuoy</span><span class="o">/</span><span class="n">owamp</span>
  <span class="n">packet_interval</span>   <span class="mf">0.1</span>
  <span class="n">sample_count</span>      <span class="mi">600</span><span class="n">every</span> <span class="mi">600</span> <span class="n">packets</span><span class="p">)</span>
<span class="o">&lt;/</span><span class="n">test_spec</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">test</span><span class="o">&gt;</span>
  <span class="n">description</span>       <span class="n">OWAMP</span> <span class="n">Tests</span>
  <span class="n">group</span>             <span class="n">owamp_group</span>
  <span class="n">test_spec</span>         <span class="n">owamp_test</span>
<span class="o">&lt;/</span><span class="n">test</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Let’s break down each portion of this file. At the top we define an organization with 2 sites, each containing one host:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">&lt;</span><span class="n">organization</span><span class="o">&gt;</span>
  <span class="n">description</span>    <span class="n">Acme</span>

  <span class="o">&lt;</span><span class="n">site</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span>
      <span class="n">description</span>    <span class="n">host1</span><span class="o">.</span><span class="n">example</span>
      <span class="n">address</span>        <span class="n">host1</span><span class="o">.</span><span class="n">example</span>
    <span class="o">&lt;/</span><span class="n">host</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">site</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="n">site</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">host</span><span class="o">&gt;</span>
      <span class="n">description</span>    <span class="n">host2</span><span class="o">.</span><span class="n">example</span>
      <span class="n">address</span>        <span class="n">host2</span><span class="o">.</span><span class="n">example</span>
    <span class="o">&lt;/</span><span class="n">host</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">site</span><span class="o">&gt;</span>

<span class="o">&lt;/</span><span class="n">organization</span><span class="o">&gt;</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The addresses of these hosts are <em>host1.example</em> and <em>host2.example</em> respectively. These hosts will be the fixed endpoints of any new testers we bring up matching the host class we have defined. Our host class, named <em>owamp_agents</em> is defined as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">owamp_agents</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">requesting_agent</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">netmask</span>
           <span class="n">netmask</span>   <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">host_properties</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">measurement_archive</span><span class="o">&gt;</span>
        <span class="nb">type</span>        <span class="n">perfsonarbuoy</span><span class="o">/</span><span class="n">owamp</span>
        <span class="n">read_url</span>    <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ma</span><span class="o">.</span><span class="n">example</span><span class="o">/</span><span class="n">esmond</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">archive</span>
        <span class="n">write_url</span>   <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ma</span><span class="o">.</span><span class="n">example</span><span class="o">/</span><span class="n">esmond</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">archive</span>
      <span class="o">&lt;/</span><span class="n">measurement_archive</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">host_properties</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The first portion to note is the <em>data_source</em> of type <em>requesting_agent</em>. This means the host class is only compared against client hosts reading this mesh. The <em>match filter</em> defined specifies we match against any host’s address that has a netmask of <em>10.0.1.0/24</em>.  In this class, we also define something called <em>host_properties</em>. This is not used for matching, instead it is properties given to a host that matches this class. In this example, it sets the measurement archive for any matching host to store data at <em>http://ma.example/esmond/perfsonar/archive</em> (our central archive in this example).</p>
<p>Once the class <em>owamp_agents</em> is defined, we are free to reference it in a test <em>group</em> as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">group</span> <span class="n">owamp_group</span><span class="o">&gt;</span>
  <span class="nb">type</span>              <span class="n">disjoint</span>

  <span class="n">a_member</span>          <span class="n">host1</span><span class="o">.</span><span class="n">example</span>
  <span class="n">a_member</span>          <span class="n">host2</span><span class="o">.</span><span class="n">example</span>

  <span class="n">b_member</span>          <span class="n">host_class</span><span class="p">::</span><span class="n">owamp_agents</span>
<span class="o">&lt;/</span><span class="n">group</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Next we define the parameters for our test:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">test_spec</span> <span class="n">owamp_test</span><span class="o">&gt;</span>
   <span class="nb">type</span>              <span class="n">perfsonarbuoy</span><span class="o">/</span><span class="n">owamp</span>
   <span class="n">packet_interval</span>   <span class="mf">0.1</span>
   <span class="n">sample_count</span>      <span class="mi">600</span><span class="n">every</span> <span class="mi">600</span> <span class="n">packets</span><span class="p">)</span>
<span class="o">&lt;/</span><span class="n">test_spec</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Finally we bring it all together in the test definition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">test</span><span class="o">&gt;</span>
  <span class="n">description</span>       <span class="n">OWAMP</span> <span class="n">Tests</span>
  <span class="n">group</span>             <span class="n">owamp_group</span>
  <span class="n">test_spec</span>         <span class="n">owamp_test</span>
<span class="o">&lt;/</span><span class="n">test</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>We can then use the <em>build_json</em> script as described in <span class="xref std std-doc">multi_mesh_server_config</span> to publish our file to a web server where clients may download it.</p>
</div>
<div class="section" id="meshconfig-client-configuration">
<span id="multi-mesh-autoconfig-fixed-client"></span><h3>MeshConfig Client Configuration<a class="headerlink" href="#meshconfig-client-configuration" title="Permalink to this headline">¶</a></h3>
<p>On each automatically configured tester you bring-up, you’ll need to point it at the JSON file generated in the previous section. Assuming the JSON file is at <a class="reference external" href="http://mesh.example/mesh.json">http://mesh.example/mesh.json</a>, you can do this in the <span class="xref std std-ref">agent configuration file</span> as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">mesh</span><span class="o">&gt;</span>
    <span class="n">configuration_url</span>   <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mesh</span><span class="o">.</span><span class="n">example</span><span class="o">/</span><span class="n">mesh</span><span class="o">.</span><span class="n">json</span>
<span class="o">&lt;/</span><span class="n">mesh</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>You’ll also want to make sure the following is set if you would like to use the measurement archive specified in the host class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">configure_archives</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This <em>configure_archives</em> option assumes the measurement archive provided by the mesh configuration file has <a class="reference internal" href="multi_ma_install.html#multi-ma-install-auth-ip"><span class="std std-ref">IP authentication</span></a> setup for this host. This is because the mesh configuration cannot securely distribute usernames and API keys. See the <a class="reference internal" href="multi_ma_install.html#multi-ma-install-auth-ip"><span class="std std-ref">measurement archive documentation</span></a> for information on how to configure IP authentication on your archive server.</p>
</div>
<p>You’ll also want to set the following if you are NOT using a Toolkit deployment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">use_toolkit</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Finally, you’ll want to make sure your <span class="xref std std-ref">MeshConfig Agent tasks file</span> has no extra measurement archives uncommented. In general having no uncommented lines is just fine.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you have additional <em>measurement_archive</em> directives in the file then your tests will be stored there IN ADDITION to those automatically configured by the mesh. This may or may not be desirable depending on your case.</p>
</div>
</div>
<div class="section" id="using-tags-with-requesting-agents">
<span id="multi-mesh-autoconfig-fixed-tags"></span><h3>Using Tags with Requesting Agents<a class="headerlink" href="#using-tags-with-requesting-agents" title="Permalink to this headline">¶</a></h3>
<p>Lets modify our host_class for this example to use a <em>tag</em> instead of a <em>netmask</em> as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">owamp_agents</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">requesting_agent</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>     <span class="n">tag</span>
           <span class="n">netmask</span>  <span class="n">latency</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">host_properties</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">measurement_archive</span><span class="o">&gt;</span>
        <span class="nb">type</span>        <span class="n">perfsonarbuoy</span><span class="o">/</span><span class="n">owamp</span>
        <span class="n">read_url</span>    <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ma</span><span class="o">.</span><span class="n">example</span><span class="o">/</span><span class="n">esmond</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">archive</span>
        <span class="n">write_url</span>   <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ma</span><span class="o">.</span><span class="n">example</span><span class="o">/</span><span class="n">esmond</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">archive</span>
      <span class="o">&lt;/</span><span class="n">measurement_archive</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">host_properties</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>
<span class="o">...</span>
</pre></div>
</div>
<p>In this case, how do we tag our agent downloading the file so that it matches this class? Normally we would do it in the <span class="xref std std-ref">host</span> directive but by definition our requesting agent does not have one of those. Instead we have to add a <em>local_host</em> block to the clients <span class="xref std std-ref">agent configuration file</span>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">local_host</span><span class="o">&gt;</span>
    <span class="n">tag</span> <span class="n">latency</span>
<span class="o">&lt;/</span><span class="n">local_host</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>If the agent host as more than one address we can also tag individual addresses as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">local_host</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">address</span><span class="o">&gt;</span>
        <span class="n">address</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.1</span>
        <span class="n">tag</span> <span class="n">latency</span>
    <span class="o">&lt;/</span><span class="n">address</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">address</span><span class="o">&gt;</span>
        <span class="n">address</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.1</span>
        <span class="n">tag</span> <span class="n">throughput</span>
    <span class="o">&lt;/</span><span class="n">address</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">local_host</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>While it does require some additional configuration on the client, it also adds flexibility in using tags to build host classes with <em>requesting_agent</em> data sources.</p>
</div>
</div>
<div class="section" id="testing-to-a-dynamic-set-of-target-hosts">
<span id="multi-mesh-autoconfig-dynamic"></span><h2>Testing to a Dynamic Set of Target Hosts<a class="headerlink" href="#testing-to-a-dynamic-set-of-target-hosts" title="Permalink to this headline">¶</a></h2>
<p>In many cases, having every host test to a fixed set of endpoints may not meet your needs. Instead, you may want a more dynamic mesh where each tester detects the existence of the others and adjusts it’s test set accordingly as members come and go. This is possible by using the MeshConfig constructs already discussed in conjunction with the <em>perfSONAR Lookup Service</em>. Such a configuration will allow you to do the following:</p>
<ul class="simple">
<li>Allow clients to automatically detect new testers, and remove any testers no longer in a mesh</li>
<li>Include dynamically added testers in an automatically generated dashboard</li>
</ul>
<p>In order for this case to work you will need access to a lookup service. It is <strong>highly recommended</strong> you use a <a class="reference external" href="https://github.com/esnet/simple-lookup-service/wiki/PrivateLookupService">private lookup service</a> for this purpose. Using the public lookup service exposes the risk of others being able to (intentionally or unintentionally) change the tests your host runs, perhaps in ways you do not desire. For more information on setting up a private lookup service see <a class="reference external" href="https://github.com/esnet/simple-lookup-service/wiki/PrivateLookupService">this document</a>. Assuming you have a private lookup service setup, you can complete the configuration process by defining the appropriate directives in your <a class="reference internal" href="#multi-mesh-autoconfig-dynamic-server"><span class="std std-ref">central MeshConfig file</span></a> and in the <a class="reference internal" href="#multi-mesh-autoconfig-dynamic-client"><span class="std std-ref">agent configuration</span></a> of the new testers.</p>
<div class="section" id="multi-mesh-autoconfig-dynamic-server">
<span id="id1"></span><h3>MeshConfig Server Configuration<a class="headerlink" href="#multi-mesh-autoconfig-dynamic-server" title="Permalink to this headline">¶</a></h3>
<p>On our MeshConfig server, the first thing we need to setup is a file that defines the hosts we want to extract from the lookup service. By default, you will find it as listed <span class="xref std std-ref">here</span> for your operating system. An example of this file using a configuration that extracts all hosts running OWAMP (the service that performs one-way latency measurements) and tagged with the community <em>example</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls_instance</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">private</span><span class="o">-</span><span class="n">ls</span><span class="o">.</span><span class="n">example</span><span class="p">:</span><span class="mi">8090</span><span class="o">/</span><span class="n">lookup</span><span class="o">/</span><span class="n">records</span>

<span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span>
    <span class="n">service_type</span> <span class="n">owamp</span>

    <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
        <span class="n">filter_key</span> <span class="n">group</span><span class="o">-</span><span class="n">communities</span>
        <span class="n">filter_value</span> <span class="n">example</span>
    <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">output_settings</span><span class="o">&gt;</span>
        <span class="n">organization_name</span> <span class="n">Acme</span>

        <span class="o">&lt;</span><span class="n">measurement_archive</span><span class="o">&gt;</span>
            <span class="nb">type</span> <span class="n">perfsonarbuoy</span><span class="o">/</span><span class="n">owamp</span>
            <span class="n">read_url</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ma</span><span class="o">.</span><span class="n">example</span><span class="o">/</span><span class="n">esmond</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">archive</span>
            <span class="n">write_url</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ma</span><span class="o">.</span><span class="n">example</span><span class="o">/</span><span class="n">esmond</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">archive</span>
        <span class="o">&lt;/</span><span class="n">measurement_archive</span><span class="o">&gt;</span>

        <span class="n">address_tag</span> <span class="n">owamp</span>
    <span class="o">&lt;/</span><span class="n">output_settings</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">query</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Let’s breakdown the major components of the file. First we have the <em>ls_instance</em> property which sets the private lookup service we want to use to query for hosts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls_instance</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">private</span><span class="o">-</span><span class="n">ls</span><span class="o">.</span><span class="n">example</span><span class="p">:</span><span class="mi">8090</span><span class="o">/</span><span class="n">lookup</span><span class="o">/</span><span class="n">records</span>
<span class="o">...</span>
</pre></div>
</div>
<p>We can have one or more of these. If you provide multiple, each lookup service will be queried in search of hosts matching the criteria. Next up we have the <em>query</em> block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span>
<span class="o">...</span>
<span class="o">&lt;/</span><span class="n">query</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>We may have one or more of these blocks in the file. This is where a bulk of the work happens. Within each query you have to define one or more service types:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">service_type</span> <span class="n">owamp</span>
</pre></div>
</div>
<p>In our example we want <em>owamp</em> services. It may also be something like <em>pscheduler</em> or <em>traceroute</em>. Next we may optionally define a list of filters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="n">filter_key</span> <span class="n">group</span><span class="o">-</span><span class="n">communities</span>
    <span class="n">filter_value</span> <span class="n">example</span>
<span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>If you don’t define any filters then all services of the specified type in the lookup service will return. For each filter that you do define, there is a <em>filter_key</em> and a <em>filter_value</em>. The key is the name of a lookup service field name you wish to match in the <strong>service</strong> record. You can find a complete list of valid field names in the <a class="reference external" href="https://docs.google.com/document/u/1/d/1dEROeTwW0R4qcLHKnA2fsWEz8fQWnPKSpPVf_FuB2Vc/pub">Lookup Service Records reference guide</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <span class="xref std std-ref">lookup hosts configuration file</span> currently only supports fields for <strong>service</strong> records and not fields in the host, interface, person or other records.</p>
</div>
<p>The <em>filter_value</em> is the value you want the field specified by the <em>filter_key</em> to take in order to match. In our example we want the <em>group-communities</em> of the service record to take the value of <em>example</em>.</p>
<p>Finally, with our filters defined, we can create <em>output_settings</em> which define what the <span class="xref std std-ref">host</span> directives look like in our MeshConfig file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">output_settings</span><span class="o">&gt;</span>
    <span class="n">organization_name</span> <span class="n">Acme</span>
    <span class="n">address_tag</span> <span class="n">owamp</span>

    <span class="o">&lt;</span><span class="n">measurement_archive</span><span class="o">&gt;</span>
        <span class="nb">type</span> <span class="n">perfsonarbuoy</span><span class="o">/</span><span class="n">owamp</span>
        <span class="n">read_url</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ma</span><span class="o">.</span><span class="n">example</span><span class="o">/</span><span class="n">esmond</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">archive</span>
        <span class="n">write_url</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ma</span><span class="o">.</span><span class="n">example</span><span class="o">/</span><span class="n">esmond</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">archive</span>
    <span class="o">&lt;/</span><span class="n">measurement_archive</span><span class="o">&gt;</span>

<span class="o">&lt;/</span><span class="n">output_settings</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>None of the fields are required but the example highlights a few common ones to set. First we can set the <em>organization_name</em>. This may be useful in later defining a host class that uses this host. In the same spirit, we can also define tags we want applied to the generated elements. In our example we apply an <em>address_tag</em> of <em>owamp</em>. Last, we can also set a <span class="xref std std-ref">measurement_archive</span> that we want the generated host elements to use. These look just like the same element we’d define in a MeshConfig file with a <em>type</em>, <em>read_url</em> and <em>write_url</em>.</p>
<p>Once this file is set, we can use it to build a host list the MeshConfig can understand with the following command:</p>
<blockquote>
<div>/usr/lib/perfsonar/bin/lookup_hosts –input /etc/perfsonar/meshconfig-lookuphosts.conf –output /var/www/dynamic_host_list.json</div></blockquote>
<p>The <em>–input</em> parameter points to the file we just generated. The <em>–output</em> points to a location we we want the generated JSON file saved. Either can be changed if you would like things setup differently on your system in terms of file paths. The output file, will contain any hosts found in the lookup service.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is highly recommended you add the <em>lookup_hosts</em> command to cron so the host list is frequently updated.</p>
</div>
<p>Assuming the JSON is published, we are ready to setup our MeshConfig file. We can do so as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">description</span>      <span class="n">Example</span> <span class="n">Dynamic</span> <span class="n">Mesh</span>

<span class="n">include</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mesh</span><span class="o">.</span><span class="n">example</span><span class="o">/</span><span class="n">dynamic_host_list</span><span class="o">.</span><span class="n">json</span>

<span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">owamp_agents</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">current_mesh</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">tag</span>
           <span class="n">netmask</span>   <span class="n">owamp</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">group</span> <span class="n">owamp_group</span><span class="o">&gt;</span>
  <span class="nb">type</span>              <span class="n">mesh</span>

  <span class="n">member</span>          <span class="n">host_class</span><span class="p">::</span><span class="n">owamp_agents</span>
<span class="o">&lt;/</span><span class="n">group</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">test_spec</span> <span class="n">owamp_test</span><span class="o">&gt;</span>
  <span class="nb">type</span>              <span class="n">perfsonarbuoy</span><span class="o">/</span><span class="n">owamp</span>
  <span class="n">packet_interval</span>   <span class="mf">0.1</span>
  <span class="n">sample_count</span>      <span class="mi">600</span><span class="n">every</span> <span class="mi">600</span> <span class="n">packets</span><span class="p">)</span>
<span class="o">&lt;/</span><span class="n">test_spec</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">test</span><span class="o">&gt;</span>
  <span class="n">description</span>       <span class="n">OWAMP</span> <span class="n">Tests</span>
  <span class="n">group</span>             <span class="n">owamp_group</span>
  <span class="n">test_spec</span>         <span class="n">owamp_test</span>
<span class="o">&lt;/</span><span class="n">test</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This file should look pretty familiar at this point, but let’s highlight some of the important parts. First we use an <em>include</em> directive to insert our dynamically generated host list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">include</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mesh</span><span class="o">.</span><span class="n">example</span><span class="o">/</span><span class="n">dynamic_host_list</span><span class="o">.</span><span class="n">json</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Next we define a <em>host_class</em> that uses the current mesh as the data source (since it has an include of our dynamic list) that matches anything tagged <em>owamp</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">owamp_agents</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">current_mesh</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">tag</span>
           <span class="n">netmask</span>   <span class="n">owamp</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Notice that we do not need to explicitly define any hosts in this case. You of course, can mix explicit and dynamically generated hosts but for this simple example it is unnecessary. With this file defined, we can now convert it to JSON and publish it for our clients to consume.</p>
</div>
<div class="section" id="multi-mesh-autoconfig-dynamic-client">
<span id="id2"></span><h3>MeshConfig Client Configuration<a class="headerlink" href="#multi-mesh-autoconfig-dynamic-client" title="Permalink to this headline">¶</a></h3>
<p>The configuration of the client in terms of the MeshConfig agent is largely the same as what is described in <span class="xref std std-doc">multi_mesh_agent_config</span> and <a class="reference internal" href="#multi-mesh-autoconfig-fixed-client"><span class="std std-ref">MeshConfig Client Configuration</span></a>. There is not anything further to add on that file, but there is extra configuration to be done of the service that registers your clients in the lookup service. Specifically you need to do the following:</p>
<ul class="simple">
<li>Add a pointer to your private lookup service</li>
<li>Configure any fields you use as a filter in <span class="xref std std-ref">lookup hosts configuration file</span> if they are not automatically generated (for example, fields like <em>group-communities</em>).</li>
</ul>
<p>For our example we can do this simply by adding the following lines to the top of the <a class="reference internal" href="config_files.html#config-files-lsreg-conf-main"><span class="std std-ref">LS Registration configuration file</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls_instance</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">private</span><span class="o">-</span><span class="n">ls</span><span class="o">.</span><span class="n">example</span><span class="p">:</span><span class="mi">8090</span><span class="o">/</span><span class="n">lookup</span><span class="o">/</span><span class="n">records</span>
<span class="n">site_project</span> <span class="n">example</span> <span class="c1">#site_project is group-communities in the lookup service</span>
</pre></div>
</div>
<p>For more information on the options available in the <a class="reference internal" href="config_files.html#config-files-lsreg-conf-main"><span class="std std-ref">LS Registration configuration file</span></a> see <a class="reference internal" href="config_ls_registration.html"><span class="doc">Lookup Service Registration Daemon Configuration File</span></a> for a complete configuration reference.</p>
</div>
</div>
<div class="section" id="examples-of-common-host-class-configurations">
<span id="multi-mesh-autoconfig-examples"></span><h2>Examples of Common Host Class Configurations<a class="headerlink" href="#examples-of-common-host-class-configurations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="testing-to-addresses-tagged-throughput-and-tagged-10gige">
<span id="multi-mesh-autoconfig-tput-lat"></span><h3>Testing to Addresses Tagged Throughput and Tagged 10GigE<a class="headerlink" href="#testing-to-addresses-tagged-throughput-and-tagged-10gige" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">throughput_hosts</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">current_mesh</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
            <span class="nb">type</span> <span class="ow">and</span> <span class="c1">#indicates all nested filters must be true</span>

           <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
               <span class="nb">type</span>   <span class="n">tag</span>
               <span class="n">tag</span>   <span class="n">throughput</span>
           <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
               <span class="nb">type</span>   <span class="n">tag</span>
               <span class="n">tag</span>   <span class="mi">10</span><span class="n">gige</span>
           <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-to-all-addresses-in-an-ip-subnet-except-a-certain-address">
<span id="multi-mesh-autoconfig-netmask"></span><h3>Testing to All Addresses in an IP Subnet Except a Certain Address<a class="headerlink" href="#testing-to-all-addresses-in-an-ip-subnet-except-a-certain-address" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">most_of_subnet</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">current_mesh</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">netmask</span>
           <span class="n">netmask</span>   <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">exclude</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">netmask</span>
           <span class="n">netmask</span>   <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.1</span><span class="o">/</span><span class="mi">32</span> <span class="c1"># Excludes 10.0.1.1 from matching</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">exclude</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-to-all-addresses-not-in-an-organization">
<span id="multi-mesh-autoconfig-organization"></span><h3>Testing to All Addresses NOT in an Organization<a class="headerlink" href="#testing-to-all-addresses-not-in-an-organization" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">non_acme_inc_hosts</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">current_mesh</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span> <span class="ow">not</span>

           <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
               <span class="nb">type</span>   <span class="n">organization</span>
               <span class="n">description</span>   <span class="n">acme</span>
           <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Alternatively using an exclude block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">non_acme_inc_hosts</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">current_mesh</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">exclude</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">organization</span>
           <span class="n">description</span>   <span class="n">acme</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">exclude</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-to-all-ipv6-addresses-tagged-latency">
<h3>Testing to All IPv6 Addresses Tagged Latency<a class="headerlink" href="#testing-to-all-ipv6-addresses-tagged-latency" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">ipv6_latency_hosts</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">current_mesh</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">address_type</span>
           <span class="n">address_type</span>   <span class="n">ipv6</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">tag</span>
           <span class="n">tag</span>    <span class="n">latency</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="combining-multiple-classes-in-a-match">
<h3>Combining Multiple Classes in a Match<a class="headerlink" href="#combining-multiple-classes-in-a-match" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">subnet1_latency</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">current_mesh</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">tag</span>
           <span class="n">tag</span>   <span class="n">latency</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>  <span class="n">netmask</span>
           <span class="n">tag</span>   <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">subnet2_latency</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">current_mesh</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="n">tag</span>
           <span class="n">tag</span>   <span class="n">latency</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>  <span class="n">netmask</span>
           <span class="n">tag</span>   <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.0</span><span class="o">/</span><span class="mi">24</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">host_class</span><span class="o">&gt;</span>
    <span class="n">name</span>      <span class="n">subnet1and2_latency</span>

    <span class="o">&lt;</span><span class="n">data_source</span><span class="o">&gt;</span>
        <span class="nb">type</span>     <span class="n">current_mesh</span>
    <span class="o">&lt;/</span><span class="n">data_source</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="k">class</span>
           <span class="nc">class</span>  <span class="n">subnet1_latency</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="nb">filter</span><span class="o">&gt;</span>
           <span class="nb">type</span>   <span class="k">class</span>
           <span class="nc">class</span>  <span class="n">subnet2_latency</span>
       <span class="o">&lt;/</span><span class="nb">filter</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">match</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">host_class</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <nav id="channelNav" class="channelNav">
                
                <ul>
<li><a class="reference internal" href="#">pSConfig Auto-Configuration</a><ul>
<li><a class="reference internal" href="#note-this-page-has-not-been-updated-for-4-1-still-under-construction">NOTE: THIS PAGE HAS NOT BEEN UPDATED FOR 4.1. STILL UNDER CONSTRUCTION.</a></li>
<li><a class="reference internal" href="#introducing-host-classes-and-tags">Introducing Host Classes and Tags</a></li>
<li><a class="reference internal" href="#testing-to-a-fixed-set-of-target-hosts">Testing to a Fixed Set of Target Hosts</a><ul>
<li><a class="reference internal" href="#meshconfig-server-configuration">MeshConfig Server Configuration</a></li>
<li><a class="reference internal" href="#meshconfig-client-configuration">MeshConfig Client Configuration</a></li>
<li><a class="reference internal" href="#using-tags-with-requesting-agents">Using Tags with Requesting Agents</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-to-a-dynamic-set-of-target-hosts">Testing to a Dynamic Set of Target Hosts</a><ul>
<li><a class="reference internal" href="#multi-mesh-autoconfig-dynamic-server">MeshConfig Server Configuration</a></li>
<li><a class="reference internal" href="#multi-mesh-autoconfig-dynamic-client">MeshConfig Client Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples-of-common-host-class-configurations">Examples of Common Host Class Configurations</a><ul>
<li><a class="reference internal" href="#testing-to-addresses-tagged-throughput-and-tagged-10gige">Testing to Addresses Tagged Throughput and Tagged 10GigE</a></li>
<li><a class="reference internal" href="#testing-to-all-addresses-in-an-ip-subnet-except-a-certain-address">Testing to All Addresses in an IP Subnet Except a Certain Address</a></li>
<li><a class="reference internal" href="#testing-to-all-addresses-not-in-an-organization">Testing to All Addresses NOT in an Organization</a></li>
<li><a class="reference internal" href="#testing-to-all-ipv6-addresses-tagged-latency">Testing to All IPv6 Addresses Tagged Latency</a></li>
<li><a class="reference internal" href="#combining-multiple-classes-in-a-match">Combining Multiple Classes in a Match</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                <ul>
                  <li>
                  <a href="psconfig_templates_advanced.html">Previous topic</a>
                  <ul><li><a href="psconfig_templates_advanced.html" title="previous chapter">Advanced pSConfig Templates</a></li></ul>
                  </li>
                </ul>
                  <ul>
                      <li>
                      <a href="psconfig_meshconfig_migrate.html">Next topic</a>
                      <ul><li><a href="psconfig_meshconfig_migrate.html" title="next chapter">MeshConfig to pSConfig Migration Guide</a></li></ul>
                      </li>
                  </ul>
                
                
            </nav>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="psconfig_meshconfig_migrate.html" title="MeshConfig to pSConfig Migration Guide"
             >next</a> |</li>
        <li class="right" >
          <a href="psconfig_templates_advanced.html" title="Advanced pSConfig Templates"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">perfSONAR Toolkit 4.1.6 documentation</a> &#187;</li> 
      </ul>
    </div>
    <footer id="fat">
        <div class="footerContents">
            <nav id="fatFooterNav" class="fatFooterNav">
                <ul id="menu-partners" class="menu depth-0">
                    <li id="footer-partner-text" class="partner-menu">
                        perfSONAR 
                        <br>
                        partners 
                        <br>
                        include: 
                    </li>
    
                <li id="footer-partner-esnet" class="partner-menu">
                    <a href="http://www.es.net/" title="Visit DOE's Energy Sciences Network"><img src="_static/ESnet-ps.png" alt="" style="border:none;"></a> </li>
                
                <li id="footer-partner-geant" class="partner-menu">
                    <a href="http://www.geant.org/" title="Visit GEANT"><img src="_static/geant-ps.png" alt="" style="border:none;"/></a> </li>
        
                <li id="footer-partner-iu" class="partner-menu">
                    <a href="http://www.iu.edu/" title="Visit Indiana University"><img src="_static/IU-ps.png" alt="" style="border:none;"></a> </li>

                <li id="footer-partner-i2" class="partner-menu">
                    <a href="http://www.internet2.edu/" title="Visit Internet2"><img src="_static/I2-ps.png" alt="" style="border:none;"></a> </li>
                
                <li id="footer-partner-um" class="partner-menu">
                    <a href="http://www.umich.edu/" title="Visit University of Michigan"><img src="_static/UM-ps.png" alt="" style="border:none;"></a> </li>

                </ul>

            </nav>
            <nav id="minFooterNav" class="minFooterNav">
                <span class="copyright">PERFormance Service Oriented Network monitoring ARchitecture </span>
            </nav>
          
        </div> <!-- /footerContents -->
    </footer>
    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, perfSONAR Project.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>