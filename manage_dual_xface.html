<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Configuring a Host with Multiple Interfaces &#8212; perfSONAR Toolkit 5.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css?v=68f3fa90" />
    <link rel="stylesheet" href="_static/perfsonar.css" type="text/css" />
    
    <script src="_static/documentation_options.js?v=bfa18cfb"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Firewalls and Security Software" href="manage_security.html" />
    <link rel="prev" title="Host Tuning" href="manage_tuning.html" />
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-52RNZ729B1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', 'G-52RNZ729B1');
	</script>
	 

  </head><body>
    <header>
        <div class="headerContents">
          <a href="index.html" border="0"><img src="_static/perfsonar-logo-black-full-100.png"></a>
          <div class="acctSearchContainer">
              <section id="searchBox" class="searchBox">
                  <!--Use of this code assumes agreement with the Google Custom Search Terms of Service. -->
                  <!--The terms of service are available at http://www.google.com/cse/docs/tos.html -->
                  <form action="search.html" id="cse-search-box" method="get">
                    <input type="text" name="q" size="25" class="searchInput" placeholder="Search"/>
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                  </form>
              </section>
         </div>
        </div>
    </header>
    <div style="display:block;clear:both;">
    
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="manage_security.html" title="Firewalls and Security Software"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="manage_tuning.html" title="Host Tuning"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">perfSONAR Toolkit 5.1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Configuring a Host with Multiple Interfaces</a></li> 
      </ul>
    </div>
    </div>
    
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="configuring-a-host-with-multiple-interfaces">
<h1>Configuring a Host with Multiple Interfaces<a class="headerlink" href="#configuring-a-host-with-multiple-interfaces" title="Link to this heading">¶</a></h1>
<p>You may run the perfSONAR Toolkit on a host with multiple interfaces. The most common reason to do this is to run throughput and latency tests on separate physical interfaces to prevent interference between the test types. Additional configuration is required to ensure this type of testing works properly. You will need to do the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Decide what IP addresses you are going to assign each interface. See <a class="reference internal" href="#multixface-addressing"><span class="std std-ref">IP Addressing Strategy</span></a> for a discussion on choosing subnets and other relevant decision points.</p></li>
<li><p>Setup routing rules that ensure when a source IP address is selected for a test, that  the operating system honors that IP address by sending it out the desired interface. A script is provided for this purpose and is detailed in the section <a class="reference internal" href="#multixface-route"><span class="std std-ref">Host Routing Table Configuration</span></a></p></li>
<li><p>When defining your tests either through the <a class="reference internal" href="manage_regular_tests.html"><span class="doc">configuration GUI</span></a> or <a class="reference internal" href="psconfig_templates_intro.html"><span class="doc">pSConfig template</span></a>, you need to select the desired interface. See the individual pages for a description on how to make this selection.</p></li>
</ol>
</div></blockquote>
<section id="ip-addressing-strategy">
<span id="multixface-addressing"></span><h2>IP Addressing Strategy<a class="headerlink" href="#ip-addressing-strategy" title="Link to this heading">¶</a></h2>
<p>The first decision to be made is how you are going to address the interfaces on your hosts. It is <strong>recommended</strong> that you assign each interface to a different subnet. For example, you may give each interface a /30 with the other end being the gateway. This is not strictly required but considerably simplifies the networking involved and can make debugging easier. You should consult with your local network operators when making this determination.</p>
<p>If you do decide to put both interfaces on the same subnet, special <em>sysctl</em> settings are required to prevent ARP conflicts. These are set by default on the perfSONAR Toolkit but are documented below as reference:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">arp_ignore</span><span class="o">=</span><span class="mi">1</span>
<span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">arp_announce</span><span class="o">=</span><span class="mi">2</span>
<span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">arp_filter</span><span class="o">=</span><span class="mi">1</span>
<span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">arp_filter</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="host-routing-table-configuration">
<span id="multixface-route"></span><h2>Host Routing Table Configuration<a class="headerlink" href="#host-routing-table-configuration" title="Link to this heading">¶</a></h2>
<section id="adding-routes">
<h3>Adding Routes<a class="headerlink" href="#adding-routes" title="Link to this heading">¶</a></h3>
<p>When a regular test is run (or you run a measurement at the command-line using an option to specify the source address), the operating system may or may not use the provided source IP address when deciding which interface on the local host to use for forwarding. Most default routing tables only look at the destination address when making forwarding decisions which can lead to unexpected behavior with your measurements.</p>
<p>In order to avoid this situation, you need to run a special script to aid in route table setup that will look at the source address of your outgoing measurement traffic. The script can be found at <em>/usr/lib/perfsonar/scripts/mod_interface_route</em>. For <strong>each interface on the host</strong> you will run the script and provide it with the interface name, IPv4 gateway address (if you plan to use IPv4) and the IPv6 gateway address (if you plan to use IPv6). Assume we have a host with two interfaces each having the following characteristics:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>Interface 1</dt><dd><dl class="field-list simple">
<dt class="field-odd">Interface Name<span class="colon">:</span></dt>
<dd class="field-odd"><p>eth0</p>
</dd>
<dt class="field-even">IPv4 Address<span class="colon">:</span></dt>
<dd class="field-even"><p>10.0.0.2</p>
</dd>
<dt class="field-odd">IPv4 Gateway<span class="colon">:</span></dt>
<dd class="field-odd"><p>10.0.0.1</p>
</dd>
<dt class="field-even">IPv6 Address<span class="colon">:</span></dt>
<dd class="field-even"><p>fde1:40ff:e1a3:d50e::2</p>
</dd>
<dt class="field-odd">IPv6 Gateway<span class="colon">:</span></dt>
<dd class="field-odd"><p>fde1:40ff:e1a3:d50e::1</p>
</dd>
</dl>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Interface 2</dt><dd><dl class="field-list simple">
<dt class="field-odd">Interface Name<span class="colon">:</span></dt>
<dd class="field-odd"><p>eth1</p>
</dd>
<dt class="field-even">IPv4 Address<span class="colon">:</span></dt>
<dd class="field-even"><p>10.1.1.2</p>
</dd>
<dt class="field-odd">IPv4 Gateway<span class="colon">:</span></dt>
<dd class="field-odd"><p>10.1.1.1</p>
</dd>
<dt class="field-even">IPv6 Address<span class="colon">:</span></dt>
<dd class="field-even"><p>fd7d:3189:ed46:2736::2</p>
</dd>
<dt class="field-odd">IPv6 Gateway<span class="colon">:</span></dt>
<dd class="field-odd"><p>fd7d:3189:ed46:2736::1</p>
</dd>
</dl>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>Below is an example of the commands we would run to install the rules required to correctly use both interfaces for measurement traffic:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">mod_interface_route</span> <span class="o">--</span><span class="n">command</span> <span class="n">add</span> <span class="o">--</span><span class="n">device</span> <span class="n">eth0</span> <span class="o">--</span><span class="n">ipv4_gateway</span> <span class="mf">10.0.0.1</span> <span class="o">--</span><span class="n">ipv6_gateway</span> <span class="n">fde1</span><span class="p">:</span><span class="mi">40</span><span class="n">ff</span><span class="p">:</span><span class="n">e1a3</span><span class="p">:</span><span class="n">d50e</span><span class="p">::</span><span class="mi">1</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">mod_interface_route</span> <span class="o">--</span><span class="n">command</span> <span class="n">add</span> <span class="o">--</span><span class="n">device</span> <span class="n">eth1</span> <span class="o">--</span><span class="n">ipv4_gateway</span> <span class="mf">10.1.1.1</span> <span class="o">--</span><span class="n">ipv6_gateway</span> <span class="n">fd7d</span><span class="p">:</span><span class="mi">3189</span><span class="p">:</span><span class="n">ed46</span><span class="p">:</span><span class="mi">2736</span><span class="p">::</span><span class="mi">1</span>
</pre></div>
</div>
<p>Replace the options above with those relevant to each interface on your host to create the necessary rules.</p>
<p>After performing the task above, your routes should now be setup. There are two ways to enable the newly installed rules to persist between system reboots. One is to set the <strong>mod_interface_route</strong> command to run whenever the machine boots, and the other is to configure the <strong>mod_interface_route</strong> command to run whenever the interface is brought up or torn down.</p>
<p>The easiest approach is to have the routes setup when the machine boots. To do this, it is recommended that you add the <em>mod_interface_route</em> commands to <strong>/etc/rc.local</strong>. Copy them exactly as you ran them at the command-line and they should get executed each time your host starts.</p>
<p>To have the routes setup whenever the interface is brought up, you will need to create two shell scripts: <strong>/sbin/ifup-local</strong> and <strong>/sbin/ifdown-local</strong>. The <strong>/sbin/ifup-local</strong> script gets executed whenever an interface is brought up, and will be used setup the route. The <strong>/sbin/ifdown-local</strong> script gets executed whenever an interface is brought down, and will be used to remove the route. Both scripts get executed with the interface name as the first parameter. The scripts then take the appropriate steps based on which interface is being taken up or torn down.</p>
<p>An example <strong>/sbin/ifup-local</strong> script based on the example interfaces above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#/bin/sh
INTERFACE=$1

if [ &quot;$INTERFACE&quot; == &quot;eth0&quot; ]; then
    /usr/lib/perfsonar/scripts/mod_interface_route --command add --device eth0 --ipv4_gateway 10.0.0.1 --ipv6_gateway fde1:40ff:e1a3:d50e::1
elif [ &quot;$INTERFACE&quot; == &quot;eth1&quot; ]; then
    /usr/lib/perfsonar/scripts/mod_interface_route --command add --device eth1 --ipv4_gateway 10.1.1.1 --ipv6_gateway fd7d:3189:ed46:2736::1
fi
</pre></div>
</div>
<p>An example <strong>/sbin/ifdown-local</strong> script based on the example interfaces above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/sh

INTERFACE=$1

if [ &quot;$INTERFACE&quot; == &quot;eth0&quot; -o &quot;$INTERFACE&quot; == &quot;eth1&quot; ]; then
    /usr/lib/perfsonar/scripts/mod_interface_route  --command delete --device  $1
fi
</pre></div>
</div>
<p>After you have created those scripts, make sure that they are executable by running <strong>chmod ugo+x /sbin/ifup-local /sbin/ifdown-local</strong>.</p>
</section>
<section id="viewing-routes">
<h3>Viewing Routes<a class="headerlink" href="#viewing-routes" title="Link to this heading">¶</a></h3>
<p>You may see the IPv4 changes by running the command <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">rule</span> <span class="pre">list</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ip rule list</span>
<span class="mi">0</span><span class="p">:</span>  <span class="kn">from</span> <span class="nn">all</span> <span class="n">lookup</span> <span class="n">local</span>
<span class="mi">200</span><span class="p">:</span>        <span class="kn">from</span> <span class="mf">10.0.0.2</span> <span class="n">lookup</span> <span class="n">eth0_source_route</span>
<span class="mi">200</span><span class="p">:</span>        <span class="kn">from</span> <span class="mf">10.1.1.2</span> <span class="n">lookup</span> <span class="n">eth1_source_route</span>
<span class="mi">32766</span><span class="p">:</span>      <span class="kn">from</span> <span class="nn">all</span> <span class="n">lookup</span> <span class="n">main</span>
<span class="mi">32767</span><span class="p">:</span>      <span class="kn">from</span> <span class="nn">all</span> <span class="n">lookup</span> <span class="n">default</span>
</pre></div>
</div>
<p>You may see the IPv6 changes by running the command <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">-6</span> <span class="pre">rule</span> <span class="pre">list</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ip -6 rule list</span>
<span class="mi">0</span><span class="p">:</span>  <span class="kn">from</span> <span class="nn">all</span> <span class="n">lookup</span> <span class="n">local</span>
<span class="mi">200</span><span class="p">:</span>        <span class="kn">from</span> <span class="nn">fde1</span><span class="p">:</span><span class="mi">40</span><span class="n">ff</span><span class="p">:</span><span class="n">e1a3</span><span class="p">:</span><span class="n">d50e</span><span class="p">::</span><span class="mi">2</span> <span class="n">lookup</span> <span class="n">eth0_source_route</span>
<span class="mi">200</span><span class="p">:</span>        <span class="kn">from</span> <span class="nn">fd7d</span><span class="p">:</span><span class="mi">3189</span><span class="p">:</span><span class="n">ed46</span><span class="p">:</span><span class="mi">2736</span><span class="p">::</span><span class="mi">2</span> <span class="n">lookup</span> <span class="n">eth1_source_route</span>
<span class="mi">32766</span><span class="p">:</span>      <span class="kn">from</span> <span class="nn">all</span> <span class="n">lookup</span> <span class="n">main</span>
</pre></div>
</div>
</section>
<section id="deleting-routes">
<h3>Deleting Routes<a class="headerlink" href="#deleting-routes" title="Link to this heading">¶</a></h3>
<p>If you would like to remove previously added rules and routes, simply give the <em>mod_interface_route</em> script the <em>delete</em> command and the device for which you want the rules removed. For example to remove both the rules from our previous example, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">mod_interface_route</span> <span class="o">--</span><span class="n">command</span> <span class="n">delete</span> <span class="o">--</span><span class="n">device</span> <span class="n">eth0</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">mod_interface_route</span> <span class="o">--</span><span class="n">command</span> <span class="n">delete</span> <span class="o">--</span><span class="n">device</span> <span class="n">eth1</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <nav id="channelNav" class="channelNav">
                
                <ul>
<li><a class="reference internal" href="#">Configuring a Host with Multiple Interfaces</a><ul>
<li><a class="reference internal" href="#ip-addressing-strategy">IP Addressing Strategy</a></li>
<li><a class="reference internal" href="#host-routing-table-configuration">Host Routing Table Configuration</a><ul>
<li><a class="reference internal" href="#adding-routes">Adding Routes</a></li>
<li><a class="reference internal" href="#viewing-routes">Viewing Routes</a></li>
<li><a class="reference internal" href="#deleting-routes">Deleting Routes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                <ul>
                  <li>
                  <a href="manage_tuning.html">Previous topic</a>
                  <ul><li><a href="manage_tuning.html" title="previous chapter">Host Tuning</a></li></ul>
                  </li>
                </ul>
                  <ul>
                      <li>
                      <a href="manage_security.html">Next topic</a>
                      <ul><li><a href="manage_security.html" title="next chapter">Firewalls and Security Software</a></li></ul>
                      </li>
                  </ul>
                
                
            </nav>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="manage_security.html" title="Firewalls and Security Software"
             >next</a> |</li>
        <li class="right" >
          <a href="manage_tuning.html" title="Host Tuning"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">perfSONAR Toolkit 5.1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Configuring a Host with Multiple Interfaces</a></li> 
      </ul>
    </div>
    <footer id="fat">
        <div class="footerContents">
            <nav id="fatFooterNav" class="fatFooterNav">
                <ul id="menu-partners" class="menu depth-0">
                    <li id="footer-partner-text" class="partner-menu">
                        perfSONAR 
                        <br>
                        partners 
                        <br>
                        include: 
                    </li>
    
                <li id="footer-partner-esnet" class="partner-menu">
                    <a href="http://www.es.net/" title="Visit DOE's Energy Sciences Network"><img src="_static/ESnet-ps.png" alt="" style="border:none;"></a> </li>
                
                <li id="footer-partner-geant" class="partner-menu">
                    <a href="http://www.geant.org/" title="Visit GEANT"><img src="_static/geant-ps.png" alt="" style="border:none;"/></a> </li>
        
                <li id="footer-partner-iu" class="partner-menu">
                    <a href="http://www.iu.edu/" title="Visit Indiana University"><img src="_static/IU-ps.png" alt="" style="border:none;"></a> </li>

                <li id="footer-partner-i2" class="partner-menu">
                    <a href="http://www.internet2.edu/" title="Visit Internet2"><img src="_static/I2-ps.png" alt="" style="border:none;"></a> </li>
					
				<li id="footer-partner-rnp" class="partner-menu">
                    <a href="https://www.rnp.br/en" title="Visit RNP"><img src="_static/rnp.png" alt="" style="border:none;"></a> </li>
                
                <li id="footer-partner-um" class="partner-menu">
                    <a href="http://www.umich.edu/" title="Visit University of Michigan"><img src="_static/UM-ps.png" alt="" style="border:none;"></a> </li>

                </ul>

            </nav>
            <nav id="minFooterNav" class="minFooterNav">
                <span class="copyright">PERFormance Service Oriented Network monitoring ARchitecture </span>
            </nav>
          
        </div> <!-- /footerContents -->
    </footer>
    
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, perfSONAR Project.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
  </body>
</html>